ANSI-C/cC++ Compiler for HC08 V-5.0.17, Apr 22 2003

    1:  /*
    2:  ** ###################################################################
    3:  **
    4:  **     THIS BEAN MODULE IS GENERATED BY THE TOOL. DO NOT MODIFY IT.
    5:  **
    6:  **     Filename  : Terminal.C
    7:  **
    8:  **     Project   : vph1
    9:  ** 
   10:  **     Processor : MC68HC908GP32CFB
   11:  **
   12:  **     Beantype  : AsynchroSerial
   13:  **
   14:  **     Version   : Bean 02.216, Driver 01.43, CPU db: 2.89.000
   15:  **
   16:  **     Compiler  : Metrowerks HC08 C Compiler
   17:  **
   18:  **     Date/Time : 4/30/viernes, 11:41
   19:  **
   20:  **     Abstract  :
   21:  **
   22:  **         This bean "AsynchroSerial" implements an asynchronous serial
   23:  **         communication. The bean supports different settings of 
   24:  **         parity, word width, stop-bit and communication speed,
   25:  **         user can select interrupt or polling handler.
   26:  **         Communication speed can be changed also in runtime.
   27:  **         The bean requires one on-chip asynchronous serial channel.
   28:  **
   29:  **     Settings  :
   30:  **
   31:  **         Serial channel              : SCI
   32:  **
   33:  **         Protocol
   34:  **             Init baud rate          : 9600baud
   35:  **             Width                   : 8 bits
   36:  **             Stop bits               : 1
   37:  **             Parity                  : none
   38:  **             Breaks                  : Disabled
   39:  **
   40:  **         Registers
   41:  **             Input buffer            : SCDR      [24]
   42:  **             Output buffer           : SCDR      [24]
   43:  **             Control register        : SCC1      [19]
   44:  **             Mode register           : SCC2      [20]
   45:  **             Baud setting reg.       : SCBR      [25]
   46:  **             Special register        : SCS1      [22]
   47:  **
   48:  **
   49:  **
   50:  **         Used pins                   : 
   51:  **             ----------------------------------------------------
   52:  **               Function | On package |    Name
   53:  **             ----------------------------------------------------
   54:  **                Output  |     9      |  PTE0_TxD
   55:  **             ----------------------------------------------------
   56:  **
   57:  **
   58:  **
   59:  **     Contents  :
   60:  **
   61:  **         SendChar        - byte Terminal_SendChar(Terminal_TComData Chr);
   62:  **         GetCharsInTxBuf - word Terminal_GetCharsInTxBuf(void);
   63:  **
   64:  **
   65:  **     (c) Copyright UNIS, spol. s r.o. 1997-2002
   66:  **
   67:  **     UNIS, spol. s r.o.
   68:  **     Jundrovska 33
   69:  **     624 00 Brno
   70:  **     Czech Republic
   71:  **
   72:  **     http      : www.processorexpert.com
   73:  **     mail      : info@processorexpert.com
   74:  **
   75:  ** ###################################################################
   76:  */
   77:  
   78:  
   79:  /* MODULE Terminal. */
   80:  
   81:  #pragma MESSAGE DISABLE C4002 /* WARNING C4002: Result not used is ignored */
   82:  
   83:  #include "Terminal.h"
   84:  #include "APERTURA.h"
   85:  #include "IRQ.h"
   86:  #include "TIMER.h"
   87:  
   88:  
   89:  #define OVERRUN_ERR      1             /* Overrun error flag bit   */
   90:  #define FRAMING_ERR      2             /* Framing error flag bit   */
   91:  #define PARITY_ERR       4             /* Parity error flag bit    */
   92:  #define CHAR_IN_RX       8             /* Char is in RX buffer     */
   93:  #define FULL_TX          16            /* Full transmit buffer     */
   94:  #define RUNINT_FROM_TX   32            /* Interrupt is in progress */
   95:  #define FULL_RX          64            /* Full receive buffer      */
   96:  #define NOISE_ERR        128           /* Noise erorr flag bit     */
   97:  #define IDLE_ERR         256           /* Idle character flag bit  */
   98:  #define BREAK_ERR        512           /* Break detect             */
   99:  
  100:  static word SerFlag;                   /* Flags for serial communication */
  101:                                         /* Bits: 0 - OverRun error */
  102:                                         /*       1 - Framing error */
  103:                                         /*       2 - Parity error */
  104:                                         /*       3 - Char in RX buffer */
  105:                                         /*       4 - Full TX buffer */
  106:                                         /*       5 - Unused */
  107:                                         /*       6 - Full RX buffer */
  108:                                         /*       7 - Noise error */
  109:                                         /*       8 - Idle character  */
  110:                                         /*       9 - Break detected  */
  111:                                         /*      10 - Unused */
  112:  
  113:  
  114:  /*
  115:  ** ===================================================================
  116:  **     Method      :  HWEnDi (bean AsynchroSerial)
  117:  **
  118:  **     Description :
  119:  **         This method is internal. It is used by Processor Expert
  120:  **         only.
  121:  ** ===================================================================
  122:  */
  123:  static void HWEnDi(void)
  124:  {

Function: HWEnDi
Source  : Z:\vph1\2puertas\Casa\Code\Terminal.C
Options : -Cc -Env"GENPATH=Z:\vph1\2puertas\Casa;Z:\vph1\2puertas\Casa\bin;Z:\vph1\2puertas\Casa\cmd;*Z:\vph1\2puertas\Casa\Code;Z:\vph1\2puertas\Casa\prm;D:\Archivos de programa\Metrowerks\CodeWarrior CW08_V3.0\lib\HC08c\LIB;D:\Archivos de programa\Metrowerks\CodeWarrior CW08_V3.0\lib\HC08c\src;*D:\Archivos de programa\Metrowerks\CodeWarrior CW08_V3.0\Bin\Plugins\support\ProcessorExpert;*Z:\vph1\2puertas\Comun;*Z:\vph1\2puertas;Z:\vph1\2puertas\Casa\doc;D:\Archivos de programa\Metrowerks\CodeWarrior CW08_V3.0\lib\hc08c\include;D:\Archivos de programa\Metrowerks\CodeWarrior CW08_V3.0\Bin\Plugins\support\ProcessorExpert\PESL\HC08;D:\Archivos de programa\Metrowerks\CodeWarrior CW08_V3.0\lib\HC08c\INCLUDE" -Env"LIBPATH=D:\Archivos de programa\Metrowerks\CodeWarrior CW08_V3.0\lib\HC08c\INCLUDE" -EnvOBJPATH=Z:\vph1\2puertas\Casa\bin -EnvTEXTPATH=Z:\vph1\2puertas\Casa\bin -Lasm=%n.lst -ObjN=Z:\vph1\2puertas\Casa\vph1_Data\P&E_PEDebug_FCS-ICS-ICD\ObjectCode\Terminal.C.o -Qvtpfar -WmsgSd1106 -WmsgSd4002

  125:      SCC1_ENSCI = 1;                    /* Enable device */
  0000 1c00             BSET  6,_SCC1
  126:      SCC2_TE = 1;                       /* Enable transmitter */
  0002 1600             BSET  3,_SCC2
  127:      SCC2_RE = 0;                       /* Disable receiver */
  0004 1500             BCLR  2,_SCC2
  128:  }
  0006 81               RTS   
  129:  
  130:  
  131:  /*
  132:  ** ===================================================================
  133:  **     Method      :  Terminal_SendChar (bean AsynchroSerial)
  134:  **
  135:  **     Description :
  136:  **         Send one character to the channel. This method is
  137:  **         available only if the transmitter property is enabled.
  138:  **     Parameters  :
  139:  **         NAME            - DESCRIPTION
  140:  **         Chr             - Character to send
  141:  **     Returns     :
  142:  **         ---             - Error code, possible codes:
  143:  **                           ERR_OK - OK
  144:  **                           ERR_SPEED - This device does not work in
  145:  **                           the active speed mode
  146:  **                           ERR_TXFULL - Transmitter is full
  147:  ** ===================================================================
  148:  */
  149:  byte Terminal_SendChar(Terminal_TComData Chr)
  150:  {

Function: Terminal_SendChar
Source  : Z:\vph1\2puertas\Casa\Code\Terminal.C
Options : -Cc -Env"GENPATH=Z:\vph1\2puertas\Casa;Z:\vph1\2puertas\Casa\bin;Z:\vph1\2puertas\Casa\cmd;*Z:\vph1\2puertas\Casa\Code;Z:\vph1\2puertas\Casa\prm;D:\Archivos de programa\Metrowerks\CodeWarrior CW08_V3.0\lib\HC08c\LIB;D:\Archivos de programa\Metrowerks\CodeWarrior CW08_V3.0\lib\HC08c\src;*D:\Archivos de programa\Metrowerks\CodeWarrior CW08_V3.0\Bin\Plugins\support\ProcessorExpert;*Z:\vph1\2puertas\Comun;*Z:\vph1\2puertas;Z:\vph1\2puertas\Casa\doc;D:\Archivos de programa\Metrowerks\CodeWarrior CW08_V3.0\lib\hc08c\include;D:\Archivos de programa\Metrowerks\CodeWarrior CW08_V3.0\Bin\Plugins\support\ProcessorExpert\PESL\HC08;D:\Archivos de programa\Metrowerks\CodeWarrior CW08_V3.0\lib\HC08c\INCLUDE" -Env"LIBPATH=D:\Archivos de programa\Metrowerks\CodeWarrior CW08_V3.0\lib\HC08c\INCLUDE" -EnvOBJPATH=Z:\vph1\2puertas\Casa\bin -EnvTEXTPATH=Z:\vph1\2puertas\Casa\bin -Lasm=%n.lst -ObjN=Z:\vph1\2puertas\Casa\vph1_Data\P&E_PEDebug_FCS-ICS-ICD\ObjectCode\Terminal.C.o -Qvtpfar -WmsgSd1106 -WmsgSd4002

  151:    if(!SCS1_SCTE)                       /* Is the transmitter empty? */
  0000 0e0003           BRSET 7,_SCS1,L6 ;abs = 0006
  152:      return ERR_TXFULL;                 /* If no then error */
  0003 a60b             LDA   #11
  0005 81               RTS   
  0006          L6:     
  153:    SCDR = (byte)Chr;
  0006 b700             STA   _SCDR
  154:    return ERR_OK;                       /* OK */
  0008 4f               CLRA  
  155:  }
  0009 81               RTS   
  156:  
  157:  /*
  158:  ** ===================================================================
  159:  **     Method      :  Terminal_GetCharsInTxBuf (bean AsynchroSerial)
  160:  **
  161:  **     Description :
  162:  **         Return number of characters in the output buffer. This
  163:  **         method is available only if the transmitter property is
  164:  **         enabled.
  165:  **     Parameters  : None
  166:  **     Returns     :
  167:  **         ---             - Number of characters in the output
  168:  **                           buffer.
  169:  ** ===================================================================
  170:  */
  171:  word Terminal_GetCharsInTxBuf(void)
  172:  {

Function: Terminal_GetCharsInTxBuf
Source  : Z:\vph1\2puertas\Casa\Code\Terminal.C
Options : -Cc -Env"GENPATH=Z:\vph1\2puertas\Casa;Z:\vph1\2puertas\Casa\bin;Z:\vph1\2puertas\Casa\cmd;*Z:\vph1\2puertas\Casa\Code;Z:\vph1\2puertas\Casa\prm;D:\Archivos de programa\Metrowerks\CodeWarrior CW08_V3.0\lib\HC08c\LIB;D:\Archivos de programa\Metrowerks\CodeWarrior CW08_V3.0\lib\HC08c\src;*D:\Archivos de programa\Metrowerks\CodeWarrior CW08_V3.0\Bin\Plugins\support\ProcessorExpert;*Z:\vph1\2puertas\Comun;*Z:\vph1\2puertas;Z:\vph1\2puertas\Casa\doc;D:\Archivos de programa\Metrowerks\CodeWarrior CW08_V3.0\lib\hc08c\include;D:\Archivos de programa\Metrowerks\CodeWarrior CW08_V3.0\Bin\Plugins\support\ProcessorExpert\PESL\HC08;D:\Archivos de programa\Metrowerks\CodeWarrior CW08_V3.0\lib\HC08c\INCLUDE" -Env"LIBPATH=D:\Archivos de programa\Metrowerks\CodeWarrior CW08_V3.0\lib\HC08c\INCLUDE" -EnvOBJPATH=Z:\vph1\2puertas\Casa\bin -EnvTEXTPATH=Z:\vph1\2puertas\Casa\bin -Lasm=%n.lst -ObjN=Z:\vph1\2puertas\Casa\vph1_Data\P&E_PEDebug_FCS-ICS-ICD\ObjectCode\Terminal.C.o -Qvtpfar -WmsgSd1106 -WmsgSd4002

  173:    return (!SCS1_SCTE);                 /* Return number of chars in the transmitter buffer */
  0000 0f0003           BRCLR 7,_SCS1,L6 ;abs = 0006
  0003 5f               CLRX  
  0004 4f               CLRA  
  0005 81               RTS   
  0006          L6:     
  0006 a601             LDA   #1
  0008 5f               CLRX  
  174:  }
  0009 81               RTS   
  175:  
  176:  /*
  177:  ** ===================================================================
  178:  **     Method      :  Terminal_Init (bean AsynchroSerial)
  179:  **
  180:  **     Description :
  181:  **         This method is internal. It is used by Processor Expert
  182:  **         only.
  183:  ** ===================================================================
  184:  */
  185:  void Terminal_Init(void)
  186:  {

Function: Terminal_Init
Source  : Z:\vph1\2puertas\Casa\Code\Terminal.C
Options : -Cc -Env"GENPATH=Z:\vph1\2puertas\Casa;Z:\vph1\2puertas\Casa\bin;Z:\vph1\2puertas\Casa\cmd;*Z:\vph1\2puertas\Casa\Code;Z:\vph1\2puertas\Casa\prm;D:\Archivos de programa\Metrowerks\CodeWarrior CW08_V3.0\lib\HC08c\LIB;D:\Archivos de programa\Metrowerks\CodeWarrior CW08_V3.0\lib\HC08c\src;*D:\Archivos de programa\Metrowerks\CodeWarrior CW08_V3.0\Bin\Plugins\support\ProcessorExpert;*Z:\vph1\2puertas\Comun;*Z:\vph1\2puertas;Z:\vph1\2puertas\Casa\doc;D:\Archivos de programa\Metrowerks\CodeWarrior CW08_V3.0\lib\hc08c\include;D:\Archivos de programa\Metrowerks\CodeWarrior CW08_V3.0\Bin\Plugins\support\ProcessorExpert\PESL\HC08;D:\Archivos de programa\Metrowerks\CodeWarrior CW08_V3.0\lib\HC08c\INCLUDE" -Env"LIBPATH=D:\Archivos de programa\Metrowerks\CodeWarrior CW08_V3.0\lib\HC08c\INCLUDE" -EnvOBJPATH=Z:\vph1\2puertas\Casa\bin -EnvTEXTPATH=Z:\vph1\2puertas\Casa\bin -Lasm=%n.lst -ObjN=Z:\vph1\2puertas\Casa\vph1_Data\P&E_PEDebug_FCS-ICS-ICD\ObjectCode\Terminal.C.o -Qvtpfar -WmsgSd1106 -WmsgSd4002

  187:    SerFlag = 0;                         /* Reset flags */
  0000 4f               CLRA  
  0001 c70001           STA   SerFlag:1
  0004 c70000           STA   SerFlag
  188:    SCC1 = 0;
  0007 3f00             CLR   _SCC1
  189:    /* SCC3: R8=0,T8=0,??=0,??=0,ORIE=0,NEIE=0,FEIE=0,PEIE=0 */
  190:    SCC3 = 0;                            /* Disable error interrupts */
  0009 3f00             CLR   _SCC3
  191:    SCBR_SCP = 0;                        /* Set prescaler bits */
  000b b600             LDA   _SCBR
  000d a4cf             AND   #-49
  000f b700             STA   _SCBR
  192:    SCBR_SCR = 2;                        /* Set divisor bits */
  0011 b600             LDA   _SCBR
  0013 a4f8             AND   #-8
  0015 aa02             ORA   #2
  0017 b700             STA   _SCBR
  193:    HWEnDi();                            /* Enable/disable device according to status flags */
  0019 2000             BRA   HWEnDi
  194:  }
  195:  
  196:  
  197:  /* END Terminal. */
  198:  
  199:  
  200:  /*
  201:  ** ###################################################################
  202:  **
  203:  **     This file was created by UNIS Processor Expert 03.23 for 
  204:  **     the Motorola HC08 series of microcontrollers.
  205:  **
  206:  ** ###################################################################
  207:  */
  208:  
