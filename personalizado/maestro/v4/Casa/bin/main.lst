ANSI-C/cC++ Compiler for HC08 V-5.0.15, Apr 11 2002

    1:  /*
    2:  ** ###################################################################
    3:  **
    4:  **     Filename  : vph1.C
    5:  **
    6:  **     Project   : vph1
    7:  ** 
    8:  **     Processor : MC68HC908GP32CFB
    9:  **

Function: CBuffer::CBuffer( const CBuffer&)
Source  : Z:\vph1\maestro\v4\Casa\Code\main.cpp
Options : -Cc -Env"GENPATH=Z:\vph1\maestro\v4\Casa;Z:\vph1\maestro\v4\Casa\bin;Z:\vph1\maestro\v4\Casa\cmd;*Z:\vph1\maestro\v4\Casa\Code;Z:\vph1\maestro\v4\Casa\prm;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\LIB;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\src;*D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\Bin\Plugins\support\ProcessorExpert;*Z:\vph1\maestro\v4\Comun;*Z:\vph1\maestro\v4;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\INCLUDE" -Env"LIBPATH=D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\INCLUDE" -EnvOBJPATH=Z:\vph1\maestro\v4\Casa\bin -EnvTEXTPATH=Z:\vph1\maestro\v4\Casa\bin -Lasm=%n.lst -ObjN=Z:\vph1\maestro\v4\Casa\vph1_Data\P&E_PEDebug_FCS-ICS-ICD\ObjectCode\main.cpp.o -Qvtpfar -WmsgSd1106


No source information available for functions created by the compiler internally
  0000 87               PSHA  
  0001 89               PSHX  
  0002 89               PSHX  
  0003 8a               PULH  
  0004 97               TAX   
  0005 e601             LDA   1,X
  0007 87               PSHA  
  0008 f6               LDA   ,X
  0009 87               PSHA  
  000a 95               TSX   
  000b e606             LDA   6,X
  000d 87               PSHA  
  000e ee07             LDX   7,X
  0010 9ee603           LDA   3,SP
  0013 8a               PULH  
  0014 e701             STA   1,X
  0016 86               PULA  
  0017 f7               STA   ,X
  0018 95               TSX   
  0019 e601             LDA   1,X
  001b 87               PSHA  
  001c ee02             LDX   2,X
  001e 8a               PULH  
  001f e603             LDA   3,X
  0021 ee02             LDX   2,X
  0023 9ee701           STA   1,SP
  0026 9ee606           LDA   6,SP
  0029 87               PSHA  
  002a 8a               PULH  
  002b 86               PULA  
  002c 89               PSHX  
  002d 9eee07           LDX   7,SP
  0030 e703             STA   3,X
  0032 86               PULA  
  0033 e702             STA   2,X
  0035 95               TSX   
  0036 f6               LDA   ,X
  0037 87               PSHA  
  0038 ee01             LDX   1,X
  003a 8a               PULH  
  003b e605             LDA   5,X
  003d ee04             LDX   4,X
  003f 87               PSHA  
  0040 9ee606           LDA   6,SP
  0043 87               PSHA  
  0044 8a               PULH  
  0045 86               PULA  
  0046 89               PSHX  
  0047 9eee07           LDX   7,SP
  004a e705             STA   5,X
  004c 86               PULA  
  004d e704             STA   4,X
  004f a702             AIS   #2
  0051 81               RTS   

Function: CBuffer::operator =( const CBuffer&)
Source  : Z:\vph1\maestro\v4\Casa\Code\main.cpp
Options : -Cc -Env"GENPATH=Z:\vph1\maestro\v4\Casa;Z:\vph1\maestro\v4\Casa\bin;Z:\vph1\maestro\v4\Casa\cmd;*Z:\vph1\maestro\v4\Casa\Code;Z:\vph1\maestro\v4\Casa\prm;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\LIB;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\src;*D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\Bin\Plugins\support\ProcessorExpert;*Z:\vph1\maestro\v4\Comun;*Z:\vph1\maestro\v4;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\INCLUDE" -Env"LIBPATH=D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\INCLUDE" -EnvOBJPATH=Z:\vph1\maestro\v4\Casa\bin -EnvTEXTPATH=Z:\vph1\maestro\v4\Casa\bin -Lasm=%n.lst -ObjN=Z:\vph1\maestro\v4\Casa\vph1_Data\P&E_PEDebug_FCS-ICS-ICD\ObjectCode\main.cpp.o -Qvtpfar -WmsgSd1106


No source information available for functions created by the compiler internally
  0000 87               PSHA  
  0001 89               PSHX  
  0002 89               PSHX  
  0003 8a               PULH  
  0004 97               TAX   
  0005 e601             LDA   1,X
  0007 87               PSHA  
  0008 f6               LDA   ,X
  0009 95               TSX   
  000a ee05             LDX   5,X
  000c 89               PSHX  
  000d 95               TSX   
  000e ee07             LDX   7,X
  0010 8a               PULH  
  0011 87               PSHA  
  0012 9ee602           LDA   2,SP
  0015 e701             STA   1,X
  0017 86               PULA  
  0018 f7               STA   ,X
  0019 95               TSX   
  001a e601             LDA   1,X
  001c 87               PSHA  
  001d ee02             LDX   2,X
  001f 8a               PULH  
  0020 e603             LDA   3,X
  0022 ee02             LDX   2,X
  0024 9ee701           STA   1,SP
  0027 9ee606           LDA   6,SP
  002a 87               PSHA  
  002b 8a               PULH  
  002c 86               PULA  
  002d 89               PSHX  
  002e 9eee07           LDX   7,SP
  0031 e703             STA   3,X
  0033 86               PULA  
  0034 e702             STA   2,X
  0036 95               TSX   
  0037 f6               LDA   ,X
  0038 87               PSHA  
  0039 ee01             LDX   1,X
  003b 8a               PULH  
  003c e605             LDA   5,X
  003e ee04             LDX   4,X
  0040 87               PSHA  
  0041 9ee606           LDA   6,SP
  0044 87               PSHA  
  0045 8a               PULH  
  0046 86               PULA  
  0047 89               PSHX  
  0048 9eee07           LDX   7,SP
  004b e705             STA   5,X
  004d 86               PULA  
  004e e704             STA   4,X
  0050 9f               TXA   
  0051 8b               PSHH  
  0052 88               PULX  
  0053 a702             AIS   #2
  0055 81               RTS   
    1:  #include "pe_types.h"
    2:  #include "buffer.h"
    3:  
    4:  #define BUFFER_FULL	-2
    5:  #define ERROR		-1
    6:  
    7:  #define	GENERAL_RESET			0x01
    8:  #define SIGNALLING_CONTROL		0x80
    9:  #define SELCALL_SUBAUDIO_STATUS 0x81
   10:  #define	SIGNALLING_SETUP		0x82
   11:  #define CTSS_TX_FAST_RX_FREQ	0x83
   12:  #define	RX_TONE_PROGRAM			0x84
   13:  #define	DCS_BYTE3				0x85
   14:  #define	DCS_BYTE2				0x86
   15:  #define	DCS_BYTE1				0x87
   16:  #define GENERAL_CONTROL			0x88
   17:  #define	AUDIO_CONTROL			0x8A
   18:  #define GENERAL_PURPOSE_TIMER	0x8B
   19:  #define	SELCALL_TX				0x8D
   20:  #define	IRQ_MASK				0x8E
   21:  #define IRQ_FLAG				0x8F
   22:  
   23:  #define CTCSS_MODE	 			0
   24:  #define SELCALL_MODE 			1
   25:  
   26:  #define chip_select_ClrVal() (PTC &= ~64)
   27:  #define chip_select_SetVal() (PTC |= 64)
   28:  #define DataIn_GetVal() ((PTD) & 2)
   29:  
   30:  #define DETECT_MODE		0
   31:  #define	PREDICTIVE_MODE	1
   32:  #define	UNKNOWN_TONE	0x0f
   33:  
   34:  #ifdef __cplusplus
   35:  
   36:  class CFX828
   37:  {
   38:  	public:
   39:  		CFX828 ();
   40:  		~CFX828 ();
   41:  		
   42:  		void Init ();
   43:  		int  TxZVEI (const byte *);
   44:  		int	 TxZVEI (byte tono);
   45:  		bool IsTxBufferEmpty();
   46:  		void ProgramFastCTCSS (int tono);
   47:  		void CTCSS_tx_enable (unsigned char enable);
   48:  		void PutToneTable (byte pos, int tono);
   49:  		void SetDecoderBandwidth (byte width);
   50:  		void EnableToneDecoder (bool enable, bool mode);
   51:  		void EnableCTCSSDecoder (bool enable, bool mode);
   52:  		void IRQService ();
   53:  		char GetTone ();
   54:  		bool CTCSS_Detected (void);
   55:  		void SetRepeatTone (byte tono = 0xe) {_RepeatTone = tono;}

Function: CFX828::SetRepeatTone( unsigned char)
Source  : Z:\vph1\maestro\v4\Comun\fx828.h
Options : -Cc -Env"GENPATH=Z:\vph1\maestro\v4\Casa;Z:\vph1\maestro\v4\Casa\bin;Z:\vph1\maestro\v4\Casa\cmd;*Z:\vph1\maestro\v4\Casa\Code;Z:\vph1\maestro\v4\Casa\prm;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\LIB;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\src;*D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\Bin\Plugins\support\ProcessorExpert;*Z:\vph1\maestro\v4\Comun;*Z:\vph1\maestro\v4;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\INCLUDE" -Env"LIBPATH=D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\INCLUDE" -EnvOBJPATH=Z:\vph1\maestro\v4\Casa\bin -EnvTEXTPATH=Z:\vph1\maestro\v4\Casa\bin -Lasm=%n.lst -ObjN=Z:\vph1\maestro\v4\Casa\vph1_Data\P&E_PEDebug_FCS-ICS-ICD\ObjectCode\main.cpp.o -Qvtpfar -WmsgSd1106

  0000 87               PSHA  
  0001 95               TSX   
  0002 e603             LDA   3,X
  0004 87               PSHA  
  0005 ee04             LDX   4,X
  0007 9ee602           LDA   2,SP
  000a 8a               PULH  
  000b e704             STA   4,X
  000d 8a               PULH  
  000e 81               RTS   

Function: CFX828::CFX828( const CFX828&)
Source  : Z:\vph1\maestro\v4\Casa\Code\main.cpp
Options : -Cc -Env"GENPATH=Z:\vph1\maestro\v4\Casa;Z:\vph1\maestro\v4\Casa\bin;Z:\vph1\maestro\v4\Casa\cmd;*Z:\vph1\maestro\v4\Casa\Code;Z:\vph1\maestro\v4\Casa\prm;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\LIB;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\src;*D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\Bin\Plugins\support\ProcessorExpert;*Z:\vph1\maestro\v4\Comun;*Z:\vph1\maestro\v4;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\INCLUDE" -Env"LIBPATH=D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\INCLUDE" -EnvOBJPATH=Z:\vph1\maestro\v4\Casa\bin -EnvTEXTPATH=Z:\vph1\maestro\v4\Casa\bin -Lasm=%n.lst -ObjN=Z:\vph1\maestro\v4\Casa\vph1_Data\P&E_PEDebug_FCS-ICS-ICD\ObjectCode\main.cpp.o -Qvtpfar -WmsgSd1106


No source information available for functions created by the compiler internally
  0000 87               PSHA  
  0001 89               PSHX  
  0002 89               PSHX  
  0003 8a               PULH  
  0004 97               TAX   
  0005 e601             LDA   1,X
  0007 87               PSHA  
  0008 f6               LDA   ,X
  0009 87               PSHA  
  000a 95               TSX   
  000b e606             LDA   6,X
  000d 87               PSHA  
  000e ee07             LDX   7,X
  0010 9ee603           LDA   3,SP
  0013 8a               PULH  
  0014 e701             STA   1,X
  0016 86               PULA  
  0017 f7               STA   ,X
  0018 95               TSX   
  0019 e601             LDA   1,X
  001b 87               PSHA  
  001c ee02             LDX   2,X
  001e 8a               PULH  
  001f e603             LDA   3,X
  0021 ee02             LDX   2,X
  0023 9ee701           STA   1,SP
  0026 9ee606           LDA   6,SP
  0029 87               PSHA  
  002a 8a               PULH  
  002b 86               PULA  
  002c 89               PSHX  
  002d 9eee07           LDX   7,SP
  0030 e703             STA   3,X
  0032 86               PULA  
  0033 e702             STA   2,X
  0035 95               TSX   
  0036 f6               LDA   ,X
  0037 87               PSHA  
  0038 ee01             LDX   1,X
  003a 8a               PULH  
  003b e604             LDA   4,X
  003d 95               TSX   
  003e ee04             LDX   4,X
  0040 89               PSHX  
  0041 95               TSX   
  0042 ee06             LDX   6,X
  0044 8a               PULH  
  0045 e704             STA   4,X
  0047 a702             AIS   #2
  0049 81               RTS   

Function: CFX828::operator =( const CFX828&)
Source  : Z:\vph1\maestro\v4\Casa\Code\main.cpp
Options : -Cc -Env"GENPATH=Z:\vph1\maestro\v4\Casa;Z:\vph1\maestro\v4\Casa\bin;Z:\vph1\maestro\v4\Casa\cmd;*Z:\vph1\maestro\v4\Casa\Code;Z:\vph1\maestro\v4\Casa\prm;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\LIB;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\src;*D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\Bin\Plugins\support\ProcessorExpert;*Z:\vph1\maestro\v4\Comun;*Z:\vph1\maestro\v4;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\INCLUDE" -Env"LIBPATH=D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\INCLUDE" -EnvOBJPATH=Z:\vph1\maestro\v4\Casa\bin -EnvTEXTPATH=Z:\vph1\maestro\v4\Casa\bin -Lasm=%n.lst -ObjN=Z:\vph1\maestro\v4\Casa\vph1_Data\P&E_PEDebug_FCS-ICS-ICD\ObjectCode\main.cpp.o -Qvtpfar -WmsgSd1106


No source information available for functions created by the compiler internally
  0000 87               PSHA  
  0001 89               PSHX  
  0002 89               PSHX  
  0003 8a               PULH  
  0004 97               TAX   
  0005 e604             LDA   4,X
  0007 95               TSX   
  0008 ee04             LDX   4,X
  000a 89               PSHX  
  000b 95               TSX   
  000c ee06             LDX   6,X
  000e 8a               PULH  
  000f e704             STA   4,X
  0011 95               TSX   
  0012 f6               LDA   ,X
  0013 87               PSHA  
  0014 ee01             LDX   1,X
  0016 8a               PULH  
  0017 e601             LDA   1,X
  0019 fe               LDX   ,X
  001a 87               PSHA  
  001b 9ee606           LDA   6,SP
  001e 87               PSHA  
  001f 8a               PULH  
  0020 86               PULA  
  0021 89               PSHX  
  0022 9eee07           LDX   7,SP
  0025 e701             STA   1,X
  0027 86               PULA  
  0028 f7               STA   ,X
  0029 95               TSX   
  002a f6               LDA   ,X
  002b 87               PSHA  
  002c ee01             LDX   1,X
  002e 8a               PULH  
  002f e603             LDA   3,X
  0031 ee02             LDX   2,X
  0033 87               PSHA  
  0034 9ee606           LDA   6,SP
  0037 87               PSHA  
  0038 8a               PULH  
  0039 86               PULA  
  003a 89               PSHX  
  003b 9eee07           LDX   7,SP
  003e e703             STA   3,X
  0040 86               PULA  
  0041 e702             STA   2,X
  0043 9f               TXA   
  0044 8b               PSHH  
  0045 88               PULX  
  0046 a702             AIS   #2
  0048 81               RTS   
   10:  **     Version   : Driver 01.00
   11:  **
   12:  **     Compiler  : Metrowerks HC08 C Compiler V-5.0.13
   13:  **
   14:  **     Date/Time : 4/17/jueves, 15:23
   15:  **
   16:  **     Abstract  :
   17:  **
   18:  **         Main module. 
   19:  **         Here is to be placed user's code.
   20:  **
   21:  **     Settings  :
   22:  **
   23:  **
   24:  **     Contents  :
   25:  **
   26:  **         No public methods
   27:  **
   28:  **
   29:  **     (c) Copyright UNIS, spol. s r.o. 1997-2002
   30:  **
   31:  **     UNIS, spol. s r.o.
   32:  **     Jundrovska 33
   33:  **     624 00 Brno
   34:  **     Czech Republic
   35:  **
   36:  **     http      : www.processorexpert.com
   37:  **     mail      : info@processorexpert.com
   38:  **
   39:  ** ###################################################################
   40:  */
   41:  /* MODULE vph1 */
   42:  
   43:  // PARA QUE SE LINKE CORRECTAMENTE ASEGURARSE DE QUE LA SIGUIENTE LINEA EXISTE EN EL ARCHIVO VPH1.PRM
   44:  //     HEAP_SEGMENT					 INTO  HEAP;
   45:  
   46:  //#pragma MESSAGE DISABLE C1420 /* WARNING C1420: Result of function-call is ignored. You can uncomment this line to disable this compiler warning */
   47:  
   48:  /*Including used modules for compilling procedure*/
   49:  #include "vph1.h"
   50:  #include "Cpu.h"
   51:  #include "Events.h"
   52:  #include "TIMER.h"
   53:  #include "Teclado.h"
   54:  #include "IRQ.h"
   55:  /*Include shared modules, which are used for whole project*/
   56:  #include "PE_Types.h"
   57:  #include "PE_Error.h"
   58:  #include "PE_Const.h"
   59:  #include "IO_Map.h"
   60:  #include <stdio.h>
   61:  #include <ctype.h>
   62:  #include "delay.h"
   63:  #include "maincpp.h"
   64:  #include "io_map.h"
   65:  
   66:  #include "fx828.h"
   67:  
   68:  #define CTCSS_SQL	12
   69:  
   70:  
   71:  #define APERTURA	PTC_PTC4
   72:  #define COLGADO		PTA_PTA6
   73:  #define PTT_ON		PTC_PTC2 = 0
   74:  #define PTT_OFF		PTC_PTC2 = 1
   75:  #define BEEP_ON		PTB_PTB7 = 1
   76:  #define BEEP_OFF	PTB_PTB7 = 0
   77:  
   78:  #define SQL_ABIERTO	PTD_PTD4==0
   79:  #define SQL_CERRADO PTD_PTD4==1
   80:  
   81:  #define MODE_STANDBY		0
   82:  #define MODE_COMUNICATION	1
   83:  
   84:  extern "C" byte Terminal_SendChar(byte Chr);
   85:  
   86:  unsigned int const_indicativo[1] @0xf700;
   87:  
   88:  const int RxCTCSSTable[47]={0x3d8,	/*67.0*/ 0x409,	/*69.3*/ 0x41b,	/*71.9*/
   89:  							0x44e,	/*74.4*/ 0x483,	/*77.0*/ 0x494,	/*79.7*/
   90:  							0x4cb,	/*82.5*/ 0x502,	/*85.4*/ 0x514,	/*88.5*/
   91:  							0x54c,	/*91.5*/ 0x587,	/*94.8*/ 0x594,	/*97.4*/
   92:  							0x5cb,	/*100.0*/0x607,	/*103.5*/0x645,	/*107.2*/
   93:  							0x682,	/*110.9*/0x6c0,	/*114.8*/0x6d1,	/*118.8*/
   94:  							0x710,	/*123.0*/0x750,	/*127.3*/0x7c0,	/*131.8*/
   95:  							0x802,	/*136.5*/0x884,	/*141.3*/0x886,	/*146.2*/
   96:  							0x8c9,	/*151.4*/0x90c,	/*156.7*/0x948,	/*159.8*/
   97:  							0x982,	/*162.2*/0x9c6,	/*167.9*/0xa0b,	/*173.8*/
   98:  							0xa84,	/*179.9*/0xac2,	/*183.5*/0xac9,	/*186.2*/
   99:  							0xb08,	/*189.9*/0xb44,	/*192.8*/0xb83,	/*196.6*/
  100:  							0xb8a,	/*199.5*/0xbc9,	/*203.5*/0xc06,	/*206.5*/
  101:  							0xc46,	/*210.7*/0xcc3,	/*218.1*/0xd41,	/*225.7*/
  102:  							0xd48,	/*229.1*/0xd89,	/*233.6*/0xe08,	/*241.8*/
  103:  							0xe88,	/*250.3*/0xec7};/*254.1*/
  104:  								 
  105:  const int RxZVEI1Table[15]={0xc44,	/*2400 0*/
  106:  							0x553,	/*1060 1*/
  107:  							0x5d2,	/*1160 2*/
  108:  							0x683,	/*1270 3*/
  109:  							0x70e,	/*1400 4*/
  110:  							0x7c8,	/*1530 5*/
  111:  							0x886,	/*1670 6*/
  112:  							0x949,	/*1830 7*/
  113:  							0xa42,	/*2000 8*/
  114:  							0xb43,	/*2200 9*/
  115:  							0xe46,	/*2800 A*/
  116:  							0x414,	/*810  B*/
  117:  							0x4d8,	/*970  C*/
  118:  							0x486,	/*885  D*/
  119:  							0xd45};	/*2600 E*/
  120:  
  121:  
  122:  bool SelCallDetected;
  123:  bool bSQL;
  124:  
  125:  union 		//Indicativo recibido
  126:  {
  127:  	struct
  128:  	{
  129:  		char low	:8;
  130:  		char high	:8;
  131:  	}_byte;
  132:  	int valor;
  133:  	
  134:  }IndicRx;
  135:  
  136:  void PutString (char *string)
  137:  {

Function: PutString( unsigned char*)
Source  : Z:\vph1\maestro\v4\Casa\Code\main.cpp
Options : -Cc -Env"GENPATH=Z:\vph1\maestro\v4\Casa;Z:\vph1\maestro\v4\Casa\bin;Z:\vph1\maestro\v4\Casa\cmd;*Z:\vph1\maestro\v4\Casa\Code;Z:\vph1\maestro\v4\Casa\prm;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\LIB;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\src;*D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\Bin\Plugins\support\ProcessorExpert;*Z:\vph1\maestro\v4\Comun;*Z:\vph1\maestro\v4;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\INCLUDE" -Env"LIBPATH=D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\INCLUDE" -EnvOBJPATH=Z:\vph1\maestro\v4\Casa\bin -EnvTEXTPATH=Z:\vph1\maestro\v4\Casa\bin -Lasm=%n.lst -ObjN=Z:\vph1\maestro\v4\Casa\vph1_Data\P&E_PEDebug_FCS-ICS-ICD\ObjectCode\main.cpp.o -Qvtpfar -WmsgSd1106

  0000 87               PSHA  
  0001 89               PSHX  
  0002 a7fe             AIS   #-2
  138:  	int n;
  139:  	for (n=0;string[n]!=0;n++)
  0004 95               TSX   
  0005 6f01             CLR   1,X
  0007 7f               CLR   ,X
  0008 200f             BRA   L19 ;abs = 0019
  000a          LA:     
  000a ad15             BSR   L21 ;abs = 0021
  140:  		while (Terminal_SendChar (string[n])==ERR_TXFULL);
  000c f6               LDA   ,X
  000d cd0000           JSR   Terminal_SendChar
  0010 410bf7           CBEQA #11,LA ;abs = 000a
  0013 95               TSX   
  0014 6c01             INC   1,X
  0016 2601             BNE   L19 ;abs = 0019
  0018 7c               INC   ,X
  0019          L19:    
  0019 ad06             BSR   L21 ;abs = 0021
  001b 7d               TST   ,X
  001c 26ec             BNE   LA ;abs = 000a
  141:  }
  001e a704             AIS   #4
  0020 81               RTS   
  0021          L21:    
  0021 95               TSX   
  0022 e605             LDA   5,X
  0024 eb03             ADD   3,X
  0026 87               PSHA  
  0027 e602             LDA   2,X
  0029 e904             ADC   4,X
  002b 87               PSHA  
  002c 8a               PULH  
  002d 88               PULX  
  002e 81               RTS   
  142:  
  143:  CFX828 FX828;
  144:  BOOL bMode;
  145:  
  146:  void EnableTX (bool enable)
  147:  {

Function: EnableTX( unsigned char)
Source  : Z:\vph1\maestro\v4\Casa\Code\main.cpp
Options : -Cc -Env"GENPATH=Z:\vph1\maestro\v4\Casa;Z:\vph1\maestro\v4\Casa\bin;Z:\vph1\maestro\v4\Casa\cmd;*Z:\vph1\maestro\v4\Casa\Code;Z:\vph1\maestro\v4\Casa\prm;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\LIB;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\src;*D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\Bin\Plugins\support\ProcessorExpert;*Z:\vph1\maestro\v4\Comun;*Z:\vph1\maestro\v4;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\INCLUDE" -Env"LIBPATH=D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\INCLUDE" -EnvOBJPATH=Z:\vph1\maestro\v4\Casa\bin -EnvTEXTPATH=Z:\vph1\maestro\v4\Casa\bin -Lasm=%n.lst -ObjN=Z:\vph1\maestro\v4\Casa\vph1_Data\P&E_PEDebug_FCS-ICS-ICD\ObjectCode\main.cpp.o -Qvtpfar -WmsgSd1106

  0000 87               PSHA  
  148:  	FX828.Mod1Enable (enable);
  0001 450000           LDHX  @FX828
  0004 89               PSHX  
  0005 8b               PSHH  
  0006 ae1f             LDX   #31
  0008 cd0000           JSR   Mod1Enable
  000b a702             AIS   #2
  149:  //	FX828.Mod2Enable (~enable);
  150:  	FX828.CTCSS_tx_enable (enable);	//Fin transmisión
  000d 450000           LDHX  @FX828
  0010 89               PSHX  
  0011 8b               PSHH  
  0012 95               TSX   
  0013 e602             LDA   2,X
  0015 cd0000           JSR   CTCSS_tx_enable
  0018 a702             AIS   #2
  151:  	PTC_PTC2 = ~enable;
  001a 95               TSX   
  001b f6               LDA   ,X
  001c a501             BIT   #1
  001e 2604             BNE   L24 ;abs = 0024
  0020 1400             BSET  2,_PTC
  152:  }
  0022 8a               PULH  
  0023 81               RTS   
  0024          L24:    
  0024 1500             BCLR  2,_PTC
  0026 8a               PULH  
  0027 81               RTS   
  153:  
  154:  //TIMBRE
  155:  void GeneraTimbre (void)
  156:  {

Function: GeneraTimbre( void)
Source  : Z:\vph1\maestro\v4\Casa\Code\main.cpp
Options : -Cc -Env"GENPATH=Z:\vph1\maestro\v4\Casa;Z:\vph1\maestro\v4\Casa\bin;Z:\vph1\maestro\v4\Casa\cmd;*Z:\vph1\maestro\v4\Casa\Code;Z:\vph1\maestro\v4\Casa\prm;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\LIB;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\src;*D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\Bin\Plugins\support\ProcessorExpert;*Z:\vph1\maestro\v4\Comun;*Z:\vph1\maestro\v4;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\INCLUDE" -Env"LIBPATH=D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\INCLUDE" -EnvOBJPATH=Z:\vph1\maestro\v4\Casa\bin -EnvTEXTPATH=Z:\vph1\maestro\v4\Casa\bin -Lasm=%n.lst -ObjN=Z:\vph1\maestro\v4\Casa\vph1_Data\P&E_PEDebug_FCS-ICS-ICD\ObjectCode\main.cpp.o -Qvtpfar -WmsgSd1106

  0000 a7fc             AIS   #-4
  157:  	int n,i;
  158:  	
  159:  	FX828.EnableToneDecoder (FALSE,SELCALL_MODE);
  0002 450000           LDHX  @FX828
  0005 89               PSHX  
  0006 8b               PSHH  
  0007 4f               CLRA  
  0008 ae01             LDX   #1
  000a cd0000           JSR   EnableToneDecoder
  000d a702             AIS   #2
  160:  	SelCallDetected = FALSE;
  000f 4f               CLRA  
  0010 c70000           STA   SelCallDetected
  161:  	for (n=0;n<5 && COLGADO;n++)
  0013 95               TSX   
  0014 6f03             CLR   3,X
  0016 6f02             CLR   2,X
  0018 203f             BRA   L59 ;abs = 0059
  001a          L1A:    
  162:  	{
  163:  		BEEP_ON;
  001a 1e00             BSET  7,_PTB
  164:  		for (i=0;i<500 && COLGADO;i++)
  001c 95               TSX   
  001d 6f01             CLR   1,X
  001f 7f               CLR   ,X
  0020 2006             BRA   L28 ;abs = 0028
  0022          L22:    
  0022 ad51             BSR   L75 ;abs = 0075
  0024 95               TSX   
  0025 2601             BNE   L28 ;abs = 0028
  0027 7c               INC   ,X
  0028          L28:    
  0028 95               TSX   
  0029 f6               LDA   ,X
  002a 87               PSHA  
  002b ee01             LDX   1,X
  002d 8a               PULH  
  002e 6501f4           CPHX  #500
  0031 9003             BGE   L36 ;abs = 0036
  0033 0c00ec           BRSET 6,_PTA,L22 ;abs = 0022
  0036          L36:    
  165:  			delay_ms(1);
  166:  		BEEP_OFF;
  0036 1f00             BCLR  7,_PTB
  167:  		for (i=0;i<200 && COLGADO;i++)
  0038 95               TSX   
  0039 6f01             CLR   1,X
  003b 7f               CLR   ,X
  003c 2006             BRA   L44 ;abs = 0044
  003e          L3E:    
  003e ad35             BSR   L75 ;abs = 0075
  0040 95               TSX   
  0041 2601             BNE   L44 ;abs = 0044
  0043 7c               INC   ,X
  0044          L44:    
  0044 95               TSX   
  0045 f6               LDA   ,X
  0046 87               PSHA  
  0047 ee01             LDX   1,X
  0049 8a               PULH  
  004a 6500c8           CPHX  #200
  004d 9003             BGE   L52 ;abs = 0052
  004f 0c00ec           BRSET 6,_PTA,L3E ;abs = 003e
  0052          L52:    
  0052 95               TSX   
  0053 6c03             INC   3,X
  0055 2602             BNE   L59 ;abs = 0059
  0057 6c02             INC   2,X
  0059          L59:    
  0059 e602             LDA   2,X
  005b 87               PSHA  
  005c ee03             LDX   3,X
  005e 8a               PULH  
  005f 650005           CPHX  #5
  0062 9003             BGE   L67 ;abs = 0067
  0064 0c00b3           BRSET 6,_PTA,L1A ;abs = 001a
  0067          L67:    
  168:  			delay_ms(1);
  169:  	}
  170:  	FX828.EnableToneDecoder (TRUE,SELCALL_MODE);
  0067 450000           LDHX  @FX828
  006a 89               PSHX  
  006b 8b               PSHH  
  006c a601             LDA   #1
  006e 97               TAX   
  006f cd0000           JSR   EnableToneDecoder
  171:  }
  0072 a706             AIS   #6
  0074 81               RTS   
  0075          L75:    
  0075 a601             LDA   #1
  0077 5f               CLRX  
  0078 cd0000           JSR   delay_ms
  007b 95               TSX   
  007c 6c03             INC   3,X
  007e 81               RTS   
  172:  
  173:  void ErrorIndicativo(void)
  174:  {

Function: ErrorIndicativo( void)
Source  : Z:\vph1\maestro\v4\Casa\Code\main.cpp
Options : -Cc -Env"GENPATH=Z:\vph1\maestro\v4\Casa;Z:\vph1\maestro\v4\Casa\bin;Z:\vph1\maestro\v4\Casa\cmd;*Z:\vph1\maestro\v4\Casa\Code;Z:\vph1\maestro\v4\Casa\prm;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\LIB;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\src;*D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\Bin\Plugins\support\ProcessorExpert;*Z:\vph1\maestro\v4\Comun;*Z:\vph1\maestro\v4;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\INCLUDE" -Env"LIBPATH=D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\INCLUDE" -EnvOBJPATH=Z:\vph1\maestro\v4\Casa\bin -EnvTEXTPATH=Z:\vph1\maestro\v4\Casa\bin -Lasm=%n.lst -ObjN=Z:\vph1\maestro\v4\Casa\vph1_Data\P&E_PEDebug_FCS-ICS-ICD\ObjectCode\main.cpp.o -Qvtpfar -WmsgSd1106

  0000 a7fe             AIS   #-2
  175:  	int n;
  176:  	FX828.EnableToneDecoder (FALSE,SELCALL_MODE);
  0002 450000           LDHX  @FX828
  0005 89               PSHX  
  0006 8b               PSHH  
  0007 4f               CLRA  
  0008 ae01             LDX   #1
  000a cd0000           JSR   EnableToneDecoder
  000d a702             AIS   #2
  177:  	FX828.ZVEI_tx_enable (TRUE);
  000f 450000           LDHX  @FX828
  0012 89               PSHX  
  0013 8b               PSHH  
  0014 a601             LDA   #1
  0016 cd0000           JSR   ZVEI_tx_enable
  0019 a702             AIS   #2
  001b          L1B:    
  178:  
  179:  	while (TRUE)	//Mientras esté descolgado
  180:  	{
  181:  		for (n=100;n<300;n++)
  001b a664             LDA   #100
  001d 95               TSX   
  001e e701             STA   1,X
  0020 7f               CLR   ,X
  0021          L21:    
  182:  			FX828.ProgramZVEI(n);	
  0021 95               TSX   
  0022 e601             LDA   1,X
  0024 fe               LDX   ,X
  0025 87               PSHA  
  0026 cd0000           JSR   _SEXT16_32
  0029 95               TSX   
  002a cd0000           JSR   _FSFLOAT
  002d 450000           LDHX  @FX828
  0030 89               PSHX  
  0031 8b               PSHH  
  0032 95               TSX   
  0033 e605             LDA   5,X
  0035 87               PSHA  
  0036 e604             LDA   4,X
  0038 87               PSHA  
  0039 e603             LDA   3,X
  003b 87               PSHA  
  003c e602             LDA   2,X
  003e 87               PSHA  
  003f cd0000           JSR   ProgramZVEI
  0042 a706             AIS   #6
  0044 95               TSX   
  0045 6c09             INC   9,X
  0047 2602             BNE   L4B ;abs = 004b
  0049 6c08             INC   8,X
  004b          L4B:    
  004b e608             LDA   8,X
  004d 87               PSHA  
  004e ee09             LDX   9,X
  0050 8a               PULH  
  0051 65012c           CPHX  #300
  0054 a708             AIS   #8
  0056 90c3             BGE   L1B ;abs = 001b
  0058 20c7             BRA   L21 ;abs = 0021
  183:  	}
  184:  }
  185:  
  186:  //TONOS INDICACIÓN DESCONEXIÓN
  187:  void UnlinkSignal(void)
  188:  {

Function: UnlinkSignal( void)
Source  : Z:\vph1\maestro\v4\Casa\Code\main.cpp
Options : -Cc -Env"GENPATH=Z:\vph1\maestro\v4\Casa;Z:\vph1\maestro\v4\Casa\bin;Z:\vph1\maestro\v4\Casa\cmd;*Z:\vph1\maestro\v4\Casa\Code;Z:\vph1\maestro\v4\Casa\prm;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\LIB;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\src;*D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\Bin\Plugins\support\ProcessorExpert;*Z:\vph1\maestro\v4\Comun;*Z:\vph1\maestro\v4;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\INCLUDE" -Env"LIBPATH=D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\INCLUDE" -EnvOBJPATH=Z:\vph1\maestro\v4\Casa\bin -EnvTEXTPATH=Z:\vph1\maestro\v4\Casa\bin -Lasm=%n.lst -ObjN=Z:\vph1\maestro\v4\Casa\vph1_Data\P&E_PEDebug_FCS-ICS-ICD\ObjectCode\main.cpp.o -Qvtpfar -WmsgSd1106

  189:  	FX828.ProgramZVEI(400.0);	
  0000 450000           LDHX  @FX828
  0003 89               PSHX  
  0004 8b               PSHH  
  0005 4f               CLRA  
  0006 87               PSHA  
  0007 87               PSHA  
  0008 4543c8           LDHX  #17352
  000b 89               PSHX  
  000c 8b               PSHH  
  000d cd0000           JSR   ProgramZVEI
  0010 a706             AIS   #6
  190:  	FX828.EnableToneDecoder (FALSE,SELCALL_MODE);
  0012 450000           LDHX  @FX828
  0015 89               PSHX  
  0016 8b               PSHH  
  0017 4f               CLRA  
  0018 ae01             LDX   #1
  001a cd0000           JSR   EnableToneDecoder
  001d a702             AIS   #2
  191:  
  192:  	while (!COLGADO)	//Mientras esté descolgado
  001f 2023             BRA   L44 ;abs = 0044
  0021          L21:    
  193:  	{
  194:  		FX828.ZVEI_tx_enable (TRUE);
  0021 450000           LDHX  @FX828
  0024 89               PSHX  
  0025 8b               PSHH  
  0026 a601             LDA   #1
  0028 cd0000           JSR   ZVEI_tx_enable
  002b a702             AIS   #2
  195:  		delay_ms(100);
  002d a664             LDA   #100
  002f 5f               CLRX  
  0030 cd0000           JSR   delay_ms
  196:  		FX828.ZVEI_tx_enable (FALSE);
  0033 450000           LDHX  @FX828
  0036 89               PSHX  
  0037 8b               PSHH  
  0038 4f               CLRA  
  0039 cd0000           JSR   ZVEI_tx_enable
  003c a702             AIS   #2
  197:  		delay_ms(100);
  003e a664             LDA   #100
  0040 5f               CLRX  
  0041 cd0000           JSR   delay_ms
  0044          L44:    
  0044 0d00da           BRCLR 6,_PTA,L21 ;abs = 0021
  198:  	}
  199:  
  200:  }
  0047 81               RTS   
  201:  
  202:  //TONOS INDICACIÓN LÍNEA OCUPADA
  203:  void BussySignal(void)
  204:  {

Function: BussySignal( void)
Source  : Z:\vph1\maestro\v4\Casa\Code\main.cpp
Options : -Cc -Env"GENPATH=Z:\vph1\maestro\v4\Casa;Z:\vph1\maestro\v4\Casa\bin;Z:\vph1\maestro\v4\Casa\cmd;*Z:\vph1\maestro\v4\Casa\Code;Z:\vph1\maestro\v4\Casa\prm;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\LIB;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\src;*D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\Bin\Plugins\support\ProcessorExpert;*Z:\vph1\maestro\v4\Comun;*Z:\vph1\maestro\v4;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\INCLUDE" -Env"LIBPATH=D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\INCLUDE" -EnvOBJPATH=Z:\vph1\maestro\v4\Casa\bin -EnvTEXTPATH=Z:\vph1\maestro\v4\Casa\bin -Lasm=%n.lst -ObjN=Z:\vph1\maestro\v4\Casa\vph1_Data\P&E_PEDebug_FCS-ICS-ICD\ObjectCode\main.cpp.o -Qvtpfar -WmsgSd1106

  205:  	FX828.ProgramZVEI(400.0);	
  0000 450000           LDHX  @FX828
  0003 89               PSHX  
  0004 8b               PSHH  
  0005 4f               CLRA  
  0006 87               PSHA  
  0007 87               PSHA  
  0008 4543c8           LDHX  #17352
  000b 89               PSHX  
  000c 8b               PSHH  
  000d cd0000           JSR   ProgramZVEI
  0010 a706             AIS   #6
  206:  	FX828.EnableToneDecoder (FALSE,SELCALL_MODE);
  0012 450000           LDHX  @FX828
  0015 89               PSHX  
  0016 8b               PSHH  
  0017 4f               CLRA  
  0018 ae01             LDX   #1
  001a cd0000           JSR   EnableToneDecoder
  001d a702             AIS   #2
  207:  
  208:  	while (!COLGADO)	//Mientras esté descolgado
  001f 2025             BRA   L46 ;abs = 0046
  0021          L21:    
  209:  	{
  210:  		FX828.ZVEI_tx_enable (TRUE);
  0021 450000           LDHX  @FX828
  0024 89               PSHX  
  0025 8b               PSHH  
  0026 a601             LDA   #1
  0028 cd0000           JSR   ZVEI_tx_enable
  002b a702             AIS   #2
  211:  		delay_ms(500);
  002d a6f4             LDA   #-12
  002f ae01             LDX   #1
  0031 cd0000           JSR   delay_ms
  212:  		FX828.ZVEI_tx_enable (FALSE);
  0034 450000           LDHX  @FX828
  0037 89               PSHX  
  0038 8b               PSHH  
  0039 4f               CLRA  
  003a cd0000           JSR   ZVEI_tx_enable
  003d a702             AIS   #2
  213:  		delay_ms(500);
  003f a6f4             LDA   #-12
  0041 ae01             LDX   #1
  0043 cd0000           JSR   delay_ms
  0046          L46:    
  0046 0d00d8           BRCLR 6,_PTA,L21 ;abs = 0021
  214:  	}
  215:  }
  0049 81               RTS   
  216:  
  217:  //Antes de abrir la puerta, nos aseguramos de los rebotes del pulsador
  218:  //Si se mantienen altos fijos durante 100ms enviaremos el subtono de apertura
  219:  //y devolveremos un TRUE.
  220:  //En caso contrario devolvemos un FALSE sin ninguna acción.
  221:  
  222:  bool apertura(void)
  223:  {

Function: apertura( void)
Source  : Z:\vph1\maestro\v4\Casa\Code\main.cpp
Options : -Cc -Env"GENPATH=Z:\vph1\maestro\v4\Casa;Z:\vph1\maestro\v4\Casa\bin;Z:\vph1\maestro\v4\Casa\cmd;*Z:\vph1\maestro\v4\Casa\Code;Z:\vph1\maestro\v4\Casa\prm;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\LIB;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\src;*D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\Bin\Plugins\support\ProcessorExpert;*Z:\vph1\maestro\v4\Comun;*Z:\vph1\maestro\v4;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\INCLUDE" -Env"LIBPATH=D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\INCLUDE" -EnvOBJPATH=Z:\vph1\maestro\v4\Casa\bin -EnvTEXTPATH=Z:\vph1\maestro\v4\Casa\bin -Lasm=%n.lst -ObjN=Z:\vph1\maestro\v4\Casa\vph1_Data\P&E_PEDebug_FCS-ICS-ICD\ObjectCode\main.cpp.o -Qvtpfar -WmsgSd1106

  0000 a7fe             AIS   #-2
  224:  	char tmp=~APERTURA;
  0002 080003           BRSET 4,_PTC,L8 ;abs = 0008
  0005 a6ff             LDA   #-1
  0007 65               SKIP2 LA ;abs = 000a
  0008          L8:     
  0008 a6fe             LDA   #-2
  000a          LA:     
  000a 95               TSX   
  000b e701             STA   1,X
  225:  	char n;
  226:  
  227:  	//Bucle antirebotes	
  228:  	for (n=0;n<10;n++)
  000d 7f               CLR   ,X
  000e          LE:     
  229:  	{
  230:  		delay_ms(1);
  000e a601             LDA   #1
  0010 5f               CLRX  
  0011 cd0000           JSR   delay_ms
  231:  		if (APERTURA==tmp)
  0014 080002           BRSET 4,_PTC,L19 ;abs = 0019
  0017 4f               CLRA  
  0018 65               SKIP2 L1B ;abs = 001b
  0019          L19:    
  0019 a601             LDA   #1
  001b          L1B:    
  001b 95               TSX   
  001c e101             CMP   1,X
  001e 260b             BNE   L2B ;abs = 002b
  232:  		{
  233:  			n=0;
  0020 7f               CLR   ,X
  234:  			tmp=~APERTURA;
  0021 080003           BRSET 4,_PTC,L27 ;abs = 0027
  0024 a6ff             LDA   #-1
  0026 65               SKIP2 L29 ;abs = 0029
  0027          L27:    
  0027 a6fe             LDA   #-2
  0029          L29:    
  0029 e701             STA   1,X
  002b          L2B:    
  002b 7c               INC   ,X
  002c f6               LDA   ,X
  002d a10a             CMP   #10
  002f 25dd             BCS   LE ;abs = 000e
  235:  		}
  236:  	}
  237:  
  238:  	if (APERTURA)	//¿Ha estado la línea alta fija durante 10ms?
  0031 09002c           BRCLR 4,_PTC,L60 ;abs = 0060
  239:  	{
  240:  		EnableTX (TRUE);
  0034 a601             LDA   #1
  0036 cd0000           JSR   EnableTX
  241:  		FX828.ProgramFastCTCSS (123); //Transmitimos subtono de apertura
  0039 450000           LDHX  @FX828
  003c 89               PSHX  
  003d 8b               PSHH  
  003e a67b             LDA   #123
  0040 5f               CLRX  
  0041 cd0000           JSR   ProgramFastCTCSS
  0044 a702             AIS   #2
  242:  		delay_ms (3000);
  0046 a6b8             LDA   #-72
  0048 ae0b             LDX   #11
  004a cd0000           JSR   delay_ms
  004d          L4D:    
  243:  		while (APERTURA);			 //Mientras están pulsando el botón
  004d 0800fd           BRSET 4,_PTC,L4D ;abs = 004d
  244:  		FX828.ProgramFastCTCSS (100); //Reestablecemos subtono
  0050 450000           LDHX  @FX828
  0053 89               PSHX  
  0054 8b               PSHH  
  0055 a664             LDA   #100
  0057 5f               CLRX  
  0058 cd0000           JSR   ProgramFastCTCSS
  005b a702             AIS   #2
  245:  		return TRUE;
  005d a601             LDA   #1
  005f 21               SKIP1 L61 ;abs = 0061
  0060          L60:    
  246:  	}
  247:  	return FALSE;
  0060 4f               CLRA  
  0061          L61:    
  248:  }
  0061 a702             AIS   #2
  0063 81               RTS   
  249:  void comunicando (void)
  250:  {

Function: comunicando( void)
Source  : Z:\vph1\maestro\v4\Casa\Code\main.cpp
Options : -Cc -Env"GENPATH=Z:\vph1\maestro\v4\Casa;Z:\vph1\maestro\v4\Casa\bin;Z:\vph1\maestro\v4\Casa\cmd;*Z:\vph1\maestro\v4\Casa\Code;Z:\vph1\maestro\v4\Casa\prm;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\LIB;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\src;*D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\Bin\Plugins\support\ProcessorExpert;*Z:\vph1\maestro\v4\Comun;*Z:\vph1\maestro\v4;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\INCLUDE" -Env"LIBPATH=D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\INCLUDE" -EnvOBJPATH=Z:\vph1\maestro\v4\Casa\bin -EnvTEXTPATH=Z:\vph1\maestro\v4\Casa\bin -Lasm=%n.lst -ObjN=Z:\vph1\maestro\v4\Casa\vph1_Data\P&E_PEDebug_FCS-ICS-ICD\ObjectCode\main.cpp.o -Qvtpfar -WmsgSd1106

  0000 a7fe             AIS   #-2
  251:  	int n,i;
  252:   	FX828.PutToneTable (0,RxCTCSSTable[CTCSS_SQL]);		//Tono de SQL
  0002 450000           LDHX  @FX828
  0005 89               PSHX  
  0006 8b               PSHH  
  0007 4f               CLRA  
  0008 87               PSHA  
  0009 a6cb             LDA   #-53
  000b ae05             LDX   #5
  000d cd0000           JSR   PutToneTable
  0010 a703             AIS   #3
  253:  	for (n=1;n<15;n++)
  0012 a601             LDA   #1
  0014 95               TSX   
  0015 e701             STA   1,X
  0017 7f               CLR   ,X
  0018          L18:    
  254:  		FX828.PutToneTable (n,0);
  0018 450000           LDHX  @FX828
  001b 89               PSHX  
  001c 8b               PSHH  
  001d 95               TSX   
  001e e603             LDA   3,X
  0020 87               PSHA  
  0021 5f               CLRX  
  0022 4f               CLRA  
  0023 cd0000           JSR   PutToneTable
  0026 a703             AIS   #3
  0028 95               TSX   
  0029 6c01             INC   1,X
  002b 2601             BNE   L2E ;abs = 002e
  002d 7c               INC   ,X
  002e          L2E:    
  002e cd01d2           JSR   L1D2 ;abs = 01d2
  0031 65000f           CPHX  #15
  0034 91e2             BLT   L18 ;abs = 0018
  255:  
  256:  	FX828.EnableToneDecoder (FALSE,SELCALL_MODE);
  0036 450000           LDHX  @FX828
  0039 89               PSHX  
  003a 8b               PSHH  
  003b 4f               CLRA  
  003c ae01             LDX   #1
  003e cd0000           JSR   EnableToneDecoder
  0041 a702             AIS   #2
  257:  	FX828.EnableToneDecoder (TRUE,CTCSS_MODE);			//Ponemos el receptor de tonos en modo CTCSS
  0043 450000           LDHX  @FX828
  0046 89               PSHX  
  0047 8b               PSHH  
  0048 a601             LDA   #1
  004a 5f               CLRX  
  004b cd0000           JSR   EnableToneDecoder
  004e a702             AIS   #2
  258:  	bMode = MODE_COMUNICATION;
  0050 a601             LDA   #1
  0052 c70000           STA   bMode
  259:  
  260:  	// Tiene que haber subtono durante 1 segundo.
  261:  	for (n=0;n<500 && !bSQL;n++) delay_ms(1); 
  0055 95               TSX   
  0056 6f01             CLR   1,X
  0058 7f               CLR   ,X
  0059 2007             BRA   L62 ;abs = 0062
  005b          L5B:    
  005b cd01c8           JSR   L1C8 ;abs = 01c8
  005e 95               TSX   
  005f 2601             BNE   L62 ;abs = 0062
  0061 7c               INC   ,X
  0062          L62:    
  0062 cd01d2           JSR   L1D2 ;abs = 01d2
  0065 6501f4           CPHX  #500
  0068 9005             BGE   L6F ;abs = 006f
  006a c60000           LDA   bSQL
  006d 27ec             BEQ   L5B ;abs = 005b
  006f          L6F:    
  262:  	
  263:  	if (!bSQL)	//Si hay subtono es que la línea está ocupada
  006f c60000           LDA   bSQL
  0072 2703             BEQ   L77 ;abs = 0077
  0074 cc015d           JMP   L15D ;abs = 015d
  0077          L77:    
  0077 cd01b9           JSR   L1B9 ;abs = 01b9
  264:  	{
  265:  		even_timeout=120000;
  007a 5f               CLRX  
  007b cf0000           STX   even_timeout
  266:  //		even_timeout=2000;
  267:  		PTT_ON;
  007e 1500             BCLR  2,_PTC
  268:  		FX828.ProgramZVEI(400.0);		//Tono de espera comunicación
  0080 450000           LDHX  @FX828
  0083 89               PSHX  
  0084 8b               PSHH  
  0085 4f               CLRA  
  0086 87               PSHA  
  0087 87               PSHA  
  0088 4543c8           LDHX  #17352
  008b 89               PSHX  
  008c 8b               PSHH  
  008d cd0000           JSR   ProgramZVEI
  0090 a706             AIS   #6
  269:  		FX828.CTCSS_tx_enable (TRUE);
  0092 450000           LDHX  @FX828
  0095 89               PSHX  
  0096 8b               PSHH  
  0097 a601             LDA   #1
  0099 cd0000           JSR   CTCSS_tx_enable
  009c a702             AIS   #2
  270:  		FX828.ZVEI_tx_enable (TRUE);
  009e 450000           LDHX  @FX828
  00a1 89               PSHX  
  00a2 8b               PSHH  
  00a3 a601             LDA   #1
  00a5 cd0000           JSR   ZVEI_tx_enable
  00a8 a702             AIS   #2
  271:  		FX828.Mod1Enable (TRUE);
  00aa 450000           LDHX  @FX828
  00ad 89               PSHX  
  00ae 8b               PSHH  
  00af a601             LDA   #1
  00b1 ae1f             LDX   #31
  00b3 cd0000           JSR   Mod1Enable
  00b6 a702             AIS   #2
  272:  	
  273:  		delay_ms(100);
  00b8 a664             LDA   #100
  00ba 5f               CLRX  
  00bb cd0000           JSR   delay_ms
  00be          LBE:    
  274:  		do
  275:  		{
  276:  			if (bSQL)
  00be c60000           LDA   bSQL
  00c1 271f             BEQ   LE2 ;abs = 00e2
  277:  			{
  278:  				// Tiene que haber subtono durante 1 segundo.
  279:  				for (n=0;n<1000 && bSQL;n++) delay_ms(1); 
  00c3 95               TSX   
  00c4 6f01             CLR   1,X
  00c6 7f               CLR   ,X
  00c7 2007             BRA   LD0 ;abs = 00d0
  00c9          LC9:    
  00c9 cd01c8           JSR   L1C8 ;abs = 01c8
  00cc 95               TSX   
  00cd 2601             BNE   LD0 ;abs = 00d0
  00cf 7c               INC   ,X
  00d0          LD0:    
  00d0 cd01d2           JSR   L1D2 ;abs = 01d2
  00d3 6503e8           CPHX  #1000
  00d6 9005             BGE   LDD ;abs = 00dd
  00d8 c60000           LDA   bSQL
  00db 26ec             BNE   LC9 ;abs = 00c9
  00dd          LDD:    
  280:  				if (n>999)
  00dd 6503e7           CPHX  #999
  00e0 9208             BGT   LEA ;abs = 00ea
  00e2          LE2:    
  281:  					break;
  282:  			}
  283:  		}while (!COLGADO && even_timeout); //Mientras no cuelgan y no pasan 2 minutos
  00e2 0c0005           BRSET 6,_PTA,LEA ;abs = 00ea
  00e5 cd01ae           JSR   L1AE ;abs = 01ae
  00e8 26d4             BNE   LBE ;abs = 00be
  00ea          LEA:    
  00ea cd01ae           JSR   L1AE ;abs = 01ae
  284:  		
  285:  		if (even_timeout)
  00ed 275d             BEQ   L14C ;abs = 014c
  286:  		{	
  287:  			FX828.ZVEI_tx_enable (FALSE);
  00ef 450000           LDHX  @FX828
  00f2 89               PSHX  
  00f3 8b               PSHH  
  00f4 4f               CLRA  
  00f5 cd0000           JSR   ZVEI_tx_enable
  00f8 a702             AIS   #2
  288:  			FX828.EnableBPF (TRUE);    	//Habilitamos salida de audio rx
  00fa 450000           LDHX  @FX828
  00fd 89               PSHX  
  00fe 8b               PSHH  
  00ff a601             LDA   #1
  0101 cd0000           JSR   EnableBPF
  0104 a702             AIS   #2
  289:  			
  290:  			//Mientras recibamos subtono, no cuelguen y no salte el time out
  291:  			while (!COLGADO && even_timeout)
  0106 203d             BRA   L145 ;abs = 0145
  0108          L108:   
  292:  			{
  293:  				if (!bSQL)	//Perdemos el subtono de recepción
  0108 c60000           LDA   bSQL
  010b 262c             BNE   L139 ;abs = 0139
  294:  				{
  295:  					for (n=0;n<1000 && !bSQL;n++) delay_ms(1);
  010d 95               TSX   
  010e 6f01             CLR   1,X
  0110 7f               CLR   ,X
  0111 2007             BRA   L11A ;abs = 011a
  0113          L113:   
  0113 cd01c8           JSR   L1C8 ;abs = 01c8
  0116 95               TSX   
  0117 2601             BNE   L11A ;abs = 011a
  0119 7c               INC   ,X
  011a          L11A:   
  011a cd01d2           JSR   L1D2 ;abs = 01d2
  011d 6503e8           CPHX  #1000
  0120 9005             BGE   L127 ;abs = 0127
  0122 c60000           LDA   bSQL
  0125 27ec             BEQ   L113 ;abs = 0113
  0127          L127:   
  296:  					if (n>=999)
  0127 6503e7           CPHX  #999
  012a 910d             BLT   L139 ;abs = 0139
  297:  					{	
  298:  						even_timeout=0;
  012c 4f               CLRA  
  012d 450000           LDHX  @even_timeout
  0130 e703             STA   3,X
  0132 e702             STA   2,X
  0134 e701             STA   1,X
  0136 f7               STA   ,X
  299:  						break;
  0137 2013             BRA   L14C ;abs = 014c
  0139          L139:   
  300:  					}
  301:  				}
  302:  
  303:  				if (APERTURA)	//Si hay subtono de RX,está descolgado y pulsan apertura.
  0139 090009           BRCLR 4,_PTC,L145 ;abs = 0145
  304:  				{
  305:  					if (apertura());
  013c cd0000           JSR   apertura
  013f ad78             BSR   L1B9 ;abs = 01b9
  306:  						even_timeout = 120000;		  //Empezamos la cuenta del time out					
  0141 4f               CLRA  
  0142 c70000           STA   even_timeout
  0145          L145:   
  0145 0c0004           BRSET 6,_PTA,L14C ;abs = 014c
  0148 ad64             BSR   L1AE ;abs = 01ae
  014a 26bc             BNE   L108 ;abs = 0108
  014c          L14C:   
  307:  				}
  308:  			}
  309:  		}
  310:  	
  311:  		EnableTX (FALSE);
  014c 4f               CLRA  
  014d cd0000           JSR   EnableTX
  312:  		FX828.EnableBPF (FALSE);    	//Habilitamos salida de audio rx
  0150 450000           LDHX  @FX828
  0153 89               PSHX  
  0154 8b               PSHH  
  0155 4f               CLRA  
  0156 cd0000           JSR   EnableBPF
  0159 a702             AIS   #2
  313:  	}
  015b 2003             BRA   L160 ;abs = 0160
  015d          L15D:   
  314:  	else
  315:  		BussySignal();
  015d cd0000           JSR   BussySignal
  0160          L160:   
  316:  
  317:  	//Grabamos los tonos ZVEEI en la tabla  RX TONE PROGRAM TABLE
  318:  	for (n=0;n<15;n++)
  0160 95               TSX   
  0161 6f01             CLR   1,X
  0163 7f               CLR   ,X
  0164          L164:   
  319:  		FX828.PutToneTable (n,RxZVEI1Table[n]);
  0164 450000           LDHX  @FX828
  0167 89               PSHX  
  0168 8b               PSHH  
  0169 95               TSX   
  016a ee03             LDX   3,X
  016c 89               PSHX  
  016d 58               LSLX  
  016e 8c               CLRH  
  016f d60001           LDA   @RxZVEI1Table:1,X
  0172 de0000           LDX   @RxZVEI1Table,X
  0175 cd0000           JSR   PutToneTable
  0178 a703             AIS   #3
  017a 95               TSX   
  017b 6c01             INC   1,X
  017d 2601             BNE   L180 ;abs = 0180
  017f 7c               INC   ,X
  0180          L180:   
  0180 ad50             BSR   L1D2 ;abs = 01d2
  0182 65000f           CPHX  #15
  0185 91dd             BLT   L164 ;abs = 0164
  320:  
  321:  	FX828.EnableToneDecoder (FALSE,CTCSS_MODE);
  0187 450000           LDHX  @FX828
  018a 89               PSHX  
  018b 8b               PSHH  
  018c 4f               CLRA  
  018d 5f               CLRX  
  018e cd0000           JSR   EnableToneDecoder
  0191 a702             AIS   #2
  322:  	FX828.EnableToneDecoder (TRUE,SELCALL_MODE);
  0193 450000           LDHX  @FX828
  0196 89               PSHX  
  0197 8b               PSHH  
  0198 a601             LDA   #1
  019a 97               TAX   
  019b cd0000           JSR   EnableToneDecoder
  019e a702             AIS   #2
  323:  	bMode = MODE_STANDBY;
  01a0 4f               CLRA  
  01a1 c70000           STA   bMode
  01a4 ad08             BSR   L1AE ;abs = 01ae
  324:  	if (!even_timeout)
  01a6 2603             BNE   L1AB ;abs = 01ab
  325:  		UnlinkSignal();	
  01a8 cd0000           JSR   UnlinkSignal
  01ab          L1AB:   
  326:  	
  327:  }
  01ab a702             AIS   #2
  01ad 81               RTS   
  01ae          L1AE:   
  01ae 450000           LDHX  @even_timeout
  01b1 e603             LDA   3,X
  01b3 ea02             ORA   2,X
  01b5 ea01             ORA   1,X
  01b7 fa               ORA   ,X
  01b8 81               RTS   
  01b9          L1B9:   
  01b9 a6c0             LDA   #-64
  01bb 450001           LDHX  @even_timeout:1
  01be e702             STA   2,X
  01c0 a6d4             LDA   #-44
  01c2 e701             STA   1,X
  01c4 a601             LDA   #1
  01c6 f7               STA   ,X
  01c7 81               RTS   
  01c8          L1C8:   
  01c8 a601             LDA   #1
  01ca 5f               CLRX  
  01cb cd0000           JSR   delay_ms
  01ce 95               TSX   
  01cf 6c03             INC   3,X
  01d1 81               RTS   
  01d2          L1D2:   
  01d2 95               TSX   
  01d3 e602             LDA   2,X
  01d5 87               PSHA  
  01d6 ee03             LDX   3,X
  01d8 8a               PULH  
  01d9 81               RTS   
  328:  
  329:  void maincpp (void)
  330:  {

Function: maincpp
Source  : Z:\vph1\maestro\v4\Casa\Code\main.cpp
Options : -Cc -Env"GENPATH=Z:\vph1\maestro\v4\Casa;Z:\vph1\maestro\v4\Casa\bin;Z:\vph1\maestro\v4\Casa\cmd;*Z:\vph1\maestro\v4\Casa\Code;Z:\vph1\maestro\v4\Casa\prm;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\LIB;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\src;*D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\Bin\Plugins\support\ProcessorExpert;*Z:\vph1\maestro\v4\Comun;*Z:\vph1\maestro\v4;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\INCLUDE" -Env"LIBPATH=D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\INCLUDE" -EnvOBJPATH=Z:\vph1\maestro\v4\Casa\bin -EnvTEXTPATH=Z:\vph1\maestro\v4\Casa\bin -Lasm=%n.lst -ObjN=Z:\vph1\maestro\v4\Casa\vph1_Data\P&E_PEDebug_FCS-ICS-ICD\ObjectCode\main.cpp.o -Qvtpfar -WmsgSd1106

  0000 a7fc             AIS   #-4
  331:  	int n;
  332:  	unsigned int indicativo = *const_indicativo;
  0002 c60001           LDA   const_indicativo:1
  0005 95               TSX   
  0006 e701             STA   1,X
  0008 c60000           LDA   const_indicativo
  000b f7               STA   ,X
  333:  	
  334:  	DDRA_DDRA6 = FALSE;
  000c 1d00             BCLR  6,_DDRA
  335:  	DDRB_DDRB7 = TRUE;
  000e 1e00             BSET  7,_DDRB
  336:  	DDRC_DDRC4 = FALSE;
  0010 1900             BCLR  4,_DDRC
  337:  	DDRC_DDRC2 = TRUE;
  0012 1400             BSET  2,_DDRC
  338:  	DDRD_DDRD4 = FALSE;
  0014 1900             BCLR  4,_DDRD
  339:  	
  340:  	SelCallDetected = FALSE;
  0016 4f               CLRA  
  0017 c70000           STA   SelCallDetected
  341:  	BEEP_OFF;
  001a 1f00             BCLR  7,_PTB
  342:  	bSQL=FALSE;
  001c c70000           STA   bSQL
  001f          L1F:    
  343:  
  344:  	while (Terminal_SendChar ((UCHAR)HIBYTE (indicativo))==ERR_TXFULL);
  001f 95               TSX   
  0020 f6               LDA   ,X
  0021 cd0000           JSR   Terminal_SendChar
  0024 410bf8           CBEQA #11,L1F ;abs = 001f
  0027          L27:    
  345:  	while (Terminal_SendChar ((UCHAR)LOBYTE (indicativo))==ERR_TXFULL);
  0027 95               TSX   
  0028 e601             LDA   1,X
  002a cd0000           JSR   Terminal_SendChar
  002d a10b             CMP   #11
  002f 27f6             BEQ   L27 ;abs = 0027
  346:  
  347:  	bMode=MODE_STANDBY;
  0031 4f               CLRA  
  0032 c70000           STA   bMode
  348:  	EnableInterrupts;
  0035 9a               CLI   
  349:  	FX828.Init ();
  0036 a600             LDA   @FX828
  0038 ae00             LDX   @FX828:MSB
  003a cd0000           JSR   Init
  350:  
  351:  	//Grabamos los tonos ZVEEI en la tabla  RX TONE PROGRAM TABLE
  352:  	for (n=0;n<15;n++)
  003d 95               TSX   
  003e 6f03             CLR   3,X
  0040 6f02             CLR   2,X
  0042          L42:    
  353:  		FX828.PutToneTable (n,RxZVEI1Table[n]);
  0042 450000           LDHX  @FX828
  0045 89               PSHX  
  0046 8b               PSHH  
  0047 95               TSX   
  0048 ee05             LDX   5,X
  004a 89               PSHX  
  004b 58               LSLX  
  004c 8c               CLRH  
  004d d60001           LDA   @RxZVEI1Table:1,X
  0050 de0000           LDX   @RxZVEI1Table,X
  0053 cd0000           JSR   PutToneTable
  0056 a703             AIS   #3
  0058 95               TSX   
  0059 6c03             INC   3,X
  005b 2602             BNE   L5F ;abs = 005f
  005d 6c02             INC   2,X
  005f          L5F:    
  005f e602             LDA   2,X
  0061 87               PSHA  
  0062 ee03             LDX   3,X
  0064 8a               PULH  
  0065 65000f           CPHX  #15
  0068 91d8             BLT   L42 ;abs = 0042
  354:  		
  355:  	FX828.SetDecoderBandwidth (0x0f);				//Ponemos el ancho de banda a 2.7
  006a 450000           LDHX  @FX828
  006d 89               PSHX  
  006e 8b               PSHH  
  006f a60f             LDA   #15
  0071 cd0000           JSR   SetDecoderBandwidth
  0074 a702             AIS   #2
  356:  	FX828.ProgramFastCTCSS (100);					//Esperamos subtonos de 100 Hz
  0076 450000           LDHX  @FX828
  0079 89               PSHX  
  007a 8b               PSHH  
  007b a664             LDA   #100
  007d 5f               CLRX  
  007e cd0000           JSR   ProgramFastCTCSS
  0081 a702             AIS   #2
  357:  	FX828.Mod1Enable (FALSE);	//Deshabilitamos mod1		
  0083 450000           LDHX  @FX828
  0086 89               PSHX  
  0087 8b               PSHH  
  0088 4f               CLRA  
  0089 ae1f             LDX   #31
  008b cd0000           JSR   Mod1Enable
  008e a702             AIS   #2
  358:  	FX828.Mod2Enable (TRUE);
  0090 450000           LDHX  @FX828
  0093 89               PSHX  
  0094 8b               PSHH  
  0095 a601             LDA   #1
  0097 ae1f             LDX   #31
  0099 cd0000           JSR   Mod2Enable
  009c a702             AIS   #2
  359:  	FX828.EnableToneDecoder (TRUE,SELCALL_MODE);
  009e 450000           LDHX  @FX828
  00a1 89               PSHX  
  00a2 8b               PSHH  
  00a3 a601             LDA   #1
  00a5 97               TAX   
  00a6 cd0000           JSR   EnableToneDecoder
  00a9 a702             AIS   #2
  360:  
  361:  	if (indicativo==0xffff)
  00ab 95               TSX   
  00ac f6               LDA   ,X
  00ad 87               PSHA  
  00ae ee01             LDX   1,X
  00b0 8a               PULH  
  00b1 65ffff           CPHX  #-1
  00b4 2642             BNE   LF8 ;abs = 00f8
  362:  		ErrorIndicativo();
  00b6 cd0000           JSR   ErrorIndicativo
  00b9 203d             BRA   LF8 ;abs = 00f8
  00bb          LBB:    
  363:  
  364:  
  365:  	for(;;)
  366:  	{
  367:  		if (!COLGADO) 	//El usuario descuelga sin que llamen.
  00bb 0c000c           BRSET 6,_PTA,LCA ;abs = 00ca
  368:  		{
  369:  			delay_ms (100);
  00be a664             LDA   #100
  00c0 5f               CLRX  
  00c1 cd0000           JSR   delay_ms
  370:  			if (!COLGADO)
  00c4 0c0003           BRSET 6,_PTA,LCA ;abs = 00ca
  371:  				comunicando();				//Realiza la comunicación
  00c7 cd0000           JSR   comunicando
  00ca          LCA:    
  372:  		}
  373:  		
  374:  		//Pulsan apertura sin haber descolgado y sin que hayan llamado.
  375:  		//Pero no se recibe ningún subtono
  376:  		if (APERTURA)
  00ca 090007           BRCLR 4,_PTC,LD4 ;abs = 00d4
  377:  		{
  378:  			if (apertura());
  00cd cd0000           JSR   apertura
  379:  				EnableTX (FALSE);				
  00d0 4f               CLRA  
  00d1 cd0000           JSR   EnableTX
  00d4          LD4:    
  380:  		}
  381:  		
  382:  		if (SelCallDetected)
  00d4 c60000           LDA   SelCallDetected
  00d7 271f             BEQ   LF8 ;abs = 00f8
  383:  		{	
  384:  			if (!COLGADO)
  00d9 0c0003           BRSET 6,_PTA,LDF ;abs = 00df
  385:  				BussySignal();
  00dc cd0000           JSR   BussySignal
  00df          LDF:    
  386:  				
  387:  			if (SelCallDetected && IndicRx.valor == indicativo)	//Hemos recibido una llamada selectiva, genera timbre
  00df c60000           LDA   SelCallDetected
  00e2 27d7             BEQ   LBB ;abs = 00bb
  00e4 95               TSX   
  00e5 e601             LDA   1,X
  00e7 87               PSHA  
  00e8 f6               LDA   ,X
  00e9 87               PSHA  
  00ea c60001           LDA   IndicRx:1
  00ed ce0000           LDX   IndicRx
  00f0 cd0000           JSR   _ICMP
  00f3 26c6             BNE   LBB ;abs = 00bb
  388:  					GeneraTimbre();
  00f5 cd0000           JSR   GeneraTimbre
  00f8          LF8:    
  389:  		}
  390:  	}
  00f8 20c1             BRA   LBB ;abs = 00bb
  391:  }
  392:  
  393:  #ifdef __cplusplu
  394:  	extern "C"
  395:  #endif
  396:  void MainIRQ ()
  397:  {

Function: MainIRQ
Source  : Z:\vph1\maestro\v4\Casa\Code\main.cpp
Options : -Cc -Env"GENPATH=Z:\vph1\maestro\v4\Casa;Z:\vph1\maestro\v4\Casa\bin;Z:\vph1\maestro\v4\Casa\cmd;*Z:\vph1\maestro\v4\Casa\Code;Z:\vph1\maestro\v4\Casa\prm;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\LIB;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\src;*D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\Bin\Plugins\support\ProcessorExpert;*Z:\vph1\maestro\v4\Comun;*Z:\vph1\maestro\v4;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\INCLUDE" -Env"LIBPATH=D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\INCLUDE" -EnvOBJPATH=Z:\vph1\maestro\v4\Casa\bin -EnvTEXTPATH=Z:\vph1\maestro\v4\Casa\bin -Lasm=%n.lst -ObjN=Z:\vph1\maestro\v4\Casa\vph1_Data\P&E_PEDebug_FCS-ICS-ICD\ObjectCode\main.cpp.o -Qvtpfar -WmsgSd1106

  0000 8b               PSHH  
  398:  	static byte buffer[4];
  399:  	static bool bStart;
  400:  	static byte idx;
  401:  	byte tono;
  402:  	
  403:  	FX828.IRQService();
  0001 a600             LDA   @FX828
  0003 ae00             LDX   @FX828:MSB
  0005 cd0000           JSR   IRQService
  404:  
  405:  	tono = FX828.GetTone();
  0008 a600             LDA   @FX828
  000a ae00             LDX   @FX828:MSB
  000c cd0000           JSR   GetTone
  000f 95               TSX   
  0010 f7               STA   ,X
  406:  	
  407:  	if (bMode == MODE_STANDBY)
  0011 ce0000           LDX   bMode
  0014 2666             BNE   L7C ;abs = 007c
  408:  	{
  409:  		if (tono!=0xff && tono!=UNKNOWN_TONE)	//Hemos detectado un tono conocido
  0016 41ff63           CBEQA #-1,L7C ;abs = 007c
  0019 410f60           CBEQA #15,L7C ;abs = 007c
  410:  		{		
  411:  			if (bStart==TRUE)
  001c ce0000           LDX   bStart
  001f 5b4d             DBNZX L6E ;abs = 006e
  412:  			{
  413:  				buffer[idx++]=tono;	
  0021 ce0000           LDX   idx
  0024 89               PSHX  
  0025 5c               INCX  
  0026 cf0000           STX   idx
  0029 88               PULX  
  002a 8c               CLRH  
  002b d70000           STA   @buffer,X
  414:  				if (idx==4)
  002e c60000           LDA   idx
  0031 a104             CMP   #4
  0033 2639             BNE   L6E ;abs = 006e
  415:  				{
  416:  					IndicRx._byte.low  = MAKEBYTE (buffer[0],buffer[1]);
  0035 450000           LDHX  @buffer
  0038 f6               LDA   ,X
  0039 62               NSA   
  003a a4f0             AND   #-16
  003c ea01             ORA   1,X
  003e c80000           EOR   IndicRx
  0041 c80000           EOR   IndicRx
  0044 c70000           STA   IndicRx
  417:  					IndicRx._byte.high = MAKEBYTE (buffer[2],buffer[3]);
  0047 e602             LDA   2,X
  0049 62               NSA   
  004a a4f0             AND   #-16
  004c ea03             ORA   3,X
  004e 450001           LDHX  @IndicRx:1
  0051 f8               EOR   ,X
  0052 f8               EOR   ,X
  0053 f7               STA   ,X
  418:  					SelCallDetected = TRUE;	
  0054 a601             LDA   #1
  0056 c70000           STA   SelCallDetected
  419:  					idx =0;
  0059 4f               CLRA  
  005a c70000           STA   idx
  420:  					bStart=FALSE;
  005d c70000           STA   bStart
  0060          L60:    
  421:  
  422:  					while (Terminal_SendChar ((UCHAR)IndicRx._byte.high)==ERR_TXFULL);
  0060 c60001           LDA   IndicRx:1
  0063 ad36             BSR   L9B ;abs = 009b
  0065 27f9             BEQ   L60 ;abs = 0060
  0067          L67:    
  423:  					while (Terminal_SendChar ((UCHAR)IndicRx._byte.low)==ERR_TXFULL);				
  0067 c60000           LDA   IndicRx
  006a ad2f             BSR   L9B ;abs = 009b
  006c 27f9             BEQ   L67 ;abs = 0067
  006e          L6E:    
  424:  				}		
  425:  			}
  426:  
  427:  			if (tono==0xb)	//Inicio de trama
  006e 95               TSX   
  006f f6               LDA   ,X
  0070 a10b             CMP   #11
  0072 2608             BNE   L7C ;abs = 007c
  428:  			{
  429:  				idx=0;
  0074 4f               CLRA  
  0075 c70000           STA   idx
  430:  				bStart=TRUE;
  0078 4c               INCA  
  0079 c70000           STA   bStart
  007c          L7C:    
  431:  			}		
  432:  		}	
  433:  	}
  434:  	
  435:  	if (bMode == MODE_COMUNICATION)
  007c c60000           LDA   bMode
  007f 4b18             DBNZA L99 ;abs = 0099
  436:  	{
  437:  		switch (tono)
  0081 95               TSX   
  0082 f6               LDA   ,X
  0083 260a             BNE   L8F ;abs = 008f
  0085          L85:    
  438:  		{
  439:  			case 0:
  440:  				while (Terminal_SendChar ((UCHAR)'1')==ERR_TXFULL);
  0085 a631             LDA   #49
  0087 ad12             BSR   L9B ;abs = 009b
  0089 27fa             BEQ   L85 ;abs = 0085
  441:  				bSQL = TRUE;
  008b a601             LDA   #1
  442:  			break;
  008d 2007             BRA   L96 ;abs = 0096
  008f          L8F:    
  443:  			
  444:  			default:
  445:  				while (Terminal_SendChar ((UCHAR)'0')==ERR_TXFULL);
  008f a630             LDA   #48
  0091 ad08             BSR   L9B ;abs = 009b
  0093 27fa             BEQ   L8F ;abs = 008f
  446:  				bSQL = FALSE;
  0095 4f               CLRA  
  0096          L96:    
  0096 c70000           STA   bSQL
  0099          L99:    
  447:  			break;
  448:  		}		
  449:  	}
  450:  	
  451:  	
  452:  }
  0099 8a               PULH  
  009a 81               RTS   
  009b          L9B:    
  009b cd0000           JSR   Terminal_SendChar
  009e a10b             CMP   #11
  00a0 81               RTS   

Function: __ConstructorInit__
Source  : Z:\vph1\maestro\v4\Casa\Code\main.cpp
Options : -Cc -Env"GENPATH=Z:\vph1\maestro\v4\Casa;Z:\vph1\maestro\v4\Casa\bin;Z:\vph1\maestro\v4\Casa\cmd;*Z:\vph1\maestro\v4\Casa\Code;Z:\vph1\maestro\v4\Casa\prm;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\LIB;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\src;*D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\Bin\Plugins\support\ProcessorExpert;*Z:\vph1\maestro\v4\Comun;*Z:\vph1\maestro\v4;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\INCLUDE" -Env"LIBPATH=D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\INCLUDE" -EnvOBJPATH=Z:\vph1\maestro\v4\Casa\bin -EnvTEXTPATH=Z:\vph1\maestro\v4\Casa\bin -Lasm=%n.lst -ObjN=Z:\vph1\maestro\v4\Casa\vph1_Data\P&E_PEDebug_FCS-ICS-ICD\ObjectCode\main.cpp.o -Qvtpfar -WmsgSd1106


No source information available for functions created by the compiler internally
  0000 a600             LDA   @FX828
  0002 ae00             LDX   @FX828:MSB
  0004 cc0000           JMP   CONSTRUCTOR

Function: __DestructorInit__
Source  : Z:\vph1\maestro\v4\Casa\Code\main.cpp
Options : -Cc -Env"GENPATH=Z:\vph1\maestro\v4\Casa;Z:\vph1\maestro\v4\Casa\bin;Z:\vph1\maestro\v4\Casa\cmd;*Z:\vph1\maestro\v4\Casa\Code;Z:\vph1\maestro\v4\Casa\prm;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\LIB;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\src;*D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\Bin\Plugins\support\ProcessorExpert;*Z:\vph1\maestro\v4\Comun;*Z:\vph1\maestro\v4;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\INCLUDE" -Env"LIBPATH=D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\INCLUDE" -EnvOBJPATH=Z:\vph1\maestro\v4\Casa\bin -EnvTEXTPATH=Z:\vph1\maestro\v4\Casa\bin -Lasm=%n.lst -ObjN=Z:\vph1\maestro\v4\Casa\vph1_Data\P&E_PEDebug_FCS-ICS-ICD\ObjectCode\main.cpp.o -Qvtpfar -WmsgSd1106


No source information available for functions created by the compiler internally
  0000 a600             LDA   @FX828
  0002 ae00             LDX   @FX828:MSB
  0004 cc0000           JMP   DESTRUCTOR
  453:  
  454:  /* END vph1 */
  455:  /*
  456:  ** ###################################################################
  457:  **
  458:  **     This file was created by UNIS Processor Expert 02.89 for 
  459:  **     the Motorola HC08 series of microcontrollers.
  460:  **
  461:  ** ###################################################################
  462:  */
  463:  
