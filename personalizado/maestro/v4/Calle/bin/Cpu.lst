ANSI-C/cC++ Compiler for HC08 V-5.0.15, Apr 11 2002

    1:  /*
    2:  ** ###################################################################
    3:  **
    4:  **     THIS BEAN MODULE IS GENERATED BY THE TOOL. DO NOT MODIFY IT.
    5:  **
    6:  **     Filename  : Cpu.C
    7:  **
    8:  **     Project   : vph1
    9:  ** 
   10:  **     Processor : MC68HC908GP32CFB
   11:  **
   12:  **     Beantype  : MC68HC908GP32_44
   13:  **
   14:  **     Version   : Bean 01.062, Driver 01.06, CPU db: 2.87.041
   15:  **
   16:  **     Compiler  : Metrowerks HC08 C Compiler V-5.0.13
   17:  **
   18:  **     Date/Time : 11/2/martes, 12:14
   19:  **
   20:  **     Abstract  :
   21:  **
   22:  **         This bean "MC68HC908GP32_44" implements properties, methods,
   23:  **         and events of the CPU.
   24:  **
   25:  **     Settings  :
   26:  **
   27:  **         Clock setting
   28:  **             External clock      : 0.032768 MHz
   29:  **             CPU mode selection  : User mode
   30:  **             Initialization interrupt priority : 1
   31:  **             LVI module          : no
   32:  **
   33:  **         Speed modes
   34:  **             High speed clock    : Main clock frequency / 1
   35:  **             Internal bus clock  : 4.9152 MHz
   36:  **             Low speed mode      : Disabled
   37:  **             Slow speed mode     : Disabled
   38:  **
   39:  **     Contents  :
   40:  **
   41:  **         GetSpeedMode - byte Cpu_GetSpeedMode(void);
   42:  **         EnableInt    - void Cpu_EnableInt(void);
   43:  **         DisableInt   - void Cpu_DisableInt(void);
   44:  **
   45:  **
   46:  **     (c) Copyright UNIS, spol. s r.o. 1997-2002
   47:  **
   48:  **     UNIS, spol. s r.o.
   49:  **     Jundrovska 33
   50:  **     624 00 Brno
   51:  **     Czech Republic
   52:  **
   53:  **     http      : www.processorexpert.com
   54:  **     mail      : info@processorexpert.com
   55:  **
   56:  ** ###################################################################
   57:  */
   58:  
   59:  /* MODULE Cpu. */
   60:  #include "IRQ.h"
   61:  #include "TIMER.h"
   62:  #include "PE_Types.h"
   63:  #include "PE_Error.h"
   64:  #include "PE_Const.h"
   65:  #include "IO_Map.h"
   66:  #include "Events.h"
   67:  #include "Cpu.h"
   68:  
   69:    #define CGM_DELAY  255
   70:  
   71:  
   72:  /* Global variables */
   73:  byte CCR_reg;                          /* Current CCR register */
   74:  byte CpuMode = HIGH_SPEED;             /* Current speed mode */
   75:  
   76:  
   77:  /*
   78:  ** ===================================================================
   79:  **     Method      :  Cpu_Interrupt (bean MC68HC908GP32_44)
   80:  **
   81:  **     Description :
   82:  **         This method is internal. It is used by Processor Expert
   83:  **         only.
   84:  ** ===================================================================
   85:  */
   86:  __interrupt void Cpu_Interrupt(void)
   87:  {

Function: Cpu_Interrupt
Source  : Z:\vph1\maestro\v4\Calle\Code\Cpu.C
Options : -Cc -Env"GENPATH=Z:\vph1\maestro\v4\Calle;Z:\vph1\maestro\v4\Calle\bin;Z:\vph1\maestro\v4\Calle\cmd;*Z:\vph1\maestro\v4\Calle\Code;Z:\vph1\maestro\v4\Calle\prm;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\LIB;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\src;*D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\Bin\Plugins\support\ProcessorExpert;*Z:\vph1\maestro\v4\Comun;*Z:\vph1\maestro\v4;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\INCLUDE" -Env"LIBPATH=D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\INCLUDE" -EnvOBJPATH=Z:\vph1\maestro\v4\Calle\bin -EnvTEXTPATH=Z:\vph1\maestro\v4\Calle\bin -Lasm=%n.lst -ObjN=Z:\vph1\maestro\v4\Calle\vph1_Data\P&E_PEDebug_FCS-ICS-ICD\ObjectCode\Cpu.C.o -WmsgSd1106

   88:  }
  0000 80               RTI   
   89:  
   90:  /*
   91:  ** ===================================================================
   92:  **     Method      :  Cpu_SWIInterrupt (bean MC68HC908GP32_44)
   93:  **
   94:  **     Description :
   95:  **         This method is internal. It is used by Processor Expert
   96:  **         only.
   97:  ** ===================================================================
   98:  */
   99:  __interrupt void Cpu_SWIInterrupt(void)
  100:  {

Function: Cpu_SWIInterrupt
Source  : Z:\vph1\maestro\v4\Calle\Code\Cpu.C
Options : -Cc -Env"GENPATH=Z:\vph1\maestro\v4\Calle;Z:\vph1\maestro\v4\Calle\bin;Z:\vph1\maestro\v4\Calle\cmd;*Z:\vph1\maestro\v4\Calle\Code;Z:\vph1\maestro\v4\Calle\prm;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\LIB;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\src;*D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\Bin\Plugins\support\ProcessorExpert;*Z:\vph1\maestro\v4\Comun;*Z:\vph1\maestro\v4;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\INCLUDE" -Env"LIBPATH=D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\INCLUDE" -EnvOBJPATH=Z:\vph1\maestro\v4\Calle\bin -EnvTEXTPATH=Z:\vph1\maestro\v4\Calle\bin -Lasm=%n.lst -ObjN=Z:\vph1\maestro\v4\Calle\vph1_Data\P&E_PEDebug_FCS-ICS-ICD\ObjectCode\Cpu.C.o -WmsgSd1106

  0000 8b               PSHH  
  101:    Cpu_OnSwINT();                       /* Invoke user event */
  0001 cd0000           JSR   Cpu_OnSwINT
  102:  }
  0004 8a               PULH  
  0005 80               RTI   
  103:  
  104:  /*
  105:  ** ===================================================================
  106:  **     Method      :  Cpu_DisableInt (bean MC68HC908GP32_44)
  107:  **
  108:  **     Description :
  109:  **         Disable maskable interrupts
  110:  **     Parameters  : None
  111:  **     Returns     : Nothing
  112:  ** ===================================================================
  113:  */
  114:  /*
  115:  void Cpu_DisableInt(void)
  116:  
  117:  **      This method is implemented as macro in the header module. **
  118:  */
  119:  
  120:  /*
  121:  ** ===================================================================
  122:  **     Method      :  Cpu_EnableInt (bean MC68HC908GP32_44)
  123:  **
  124:  **     Description :
  125:  **         Enable maskable interrupts
  126:  **     Parameters  : None
  127:  **     Returns     : Nothing
  128:  ** ===================================================================
  129:  */
  130:  /*
  131:  void Cpu_EnableInt(void)
  132:  
  133:  **      This method is implemented as macro in the header module. **
  134:  */
  135:  
  136:  /*
  137:  ** ===================================================================
  138:  **     Method      :  Cpu_GetSpeedMode (bean MC68HC908GP32_44)
  139:  **
  140:  **     Description :
  141:  **         Get current speed mode
  142:  **     Parameters  : None
  143:  **     Returns     :
  144:  **         ---             - Speed mode (HIGH_SPEED, LOW_SPEED,
  145:  **                           SLOW_SPEED)
  146:  ** ===================================================================
  147:  */
  148:  byte Cpu_GetSpeedMode(void)
  149:  {

Function: Cpu_GetSpeedMode
Source  : Z:\vph1\maestro\v4\Calle\Code\Cpu.C
Options : -Cc -Env"GENPATH=Z:\vph1\maestro\v4\Calle;Z:\vph1\maestro\v4\Calle\bin;Z:\vph1\maestro\v4\Calle\cmd;*Z:\vph1\maestro\v4\Calle\Code;Z:\vph1\maestro\v4\Calle\prm;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\LIB;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\src;*D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\Bin\Plugins\support\ProcessorExpert;*Z:\vph1\maestro\v4\Comun;*Z:\vph1\maestro\v4;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\INCLUDE" -Env"LIBPATH=D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\INCLUDE" -EnvOBJPATH=Z:\vph1\maestro\v4\Calle\bin -EnvTEXTPATH=Z:\vph1\maestro\v4\Calle\bin -Lasm=%n.lst -ObjN=Z:\vph1\maestro\v4\Calle\vph1_Data\P&E_PEDebug_FCS-ICS-ICD\ObjectCode\Cpu.C.o -WmsgSd1106

  150:    return CpuMode;                      /* Result the actual cpu mode */
  0000 c60000           LDA   CpuMode
  151:  }
  0003 81               RTS   
  152:  
  153:  /*
  154:  ** ===================================================================
  155:  **         There is beginning of initialization code for CPU 
  156:  **         and embedded beans.
  157:  ** ===================================================================
  158:  */
  159:  void __low_level_init(void)
  160:  {

Function: __low_level_init
Source  : Z:\vph1\maestro\v4\Calle\Code\Cpu.C
Options : -Cc -Env"GENPATH=Z:\vph1\maestro\v4\Calle;Z:\vph1\maestro\v4\Calle\bin;Z:\vph1\maestro\v4\Calle\cmd;*Z:\vph1\maestro\v4\Calle\Code;Z:\vph1\maestro\v4\Calle\prm;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\LIB;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\src;*D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\Bin\Plugins\support\ProcessorExpert;*Z:\vph1\maestro\v4\Comun;*Z:\vph1\maestro\v4;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\INCLUDE" -Env"LIBPATH=D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\INCLUDE" -EnvOBJPATH=Z:\vph1\maestro\v4\Calle\bin -EnvTEXTPATH=Z:\vph1\maestro\v4\Calle\bin -Lasm=%n.lst -ObjN=Z:\vph1\maestro\v4\Calle\vph1_Data\P&E_PEDebug_FCS-ICS-ICD\ObjectCode\Cpu.C.o -WmsgSd1106

  161:    /* ### MC68HC908GP32_44 "Cpu" init code ... */
  162:    CONFIG1 = 17;                        /* Set the CONFIG1 register */
  0000 6e1100           MOV   #17,_CONFIG1
  163:    CONFIG2 = 0;                         /* Set the CONFIG2 register */
  0003 3f00             CLR   _CONFIG2
  164:    PCTL_BCS = 0;                        /* Select clock source from XTAL */
  0005 1900             BCLR  4,_PCTL
  165:    PCTL_PLLON = 0;                      /* Disable the PLL */
  0007 1b00             BCLR  5,_PCTL
  166:    PMS = 600;                           /* Set the multiplier */
  0009 450258           LDHX  #600
  000c 3500             STHX  _PMS
  167:    PMRS = 128;                          /* Set the range select */
  000e 6e8000           MOV   #-128,_PMRS
  168:    PCTL = 0;
  0011 3f00             CLR   _PCTL
  169:    PCTL_VPR = 2;
  0013 b600             LDA   _PCTL
  0015 a4fc             AND   #-4
  0017 aa02             ORA   #2
  0019 b700             STA   _PCTL
  170:    PBWC = 128;                          /* Select the operating modes */
  001b 6e8000           MOV   #-128,_PBWC
  171:    PCTL_PLLON = 1;                      /* Enable the PLL */
  001e 1a00             BSET  5,_PCTL
  0020          L20:    
  172:    while(!PBWC_LOCK);                   /* Wait */
  0020 0d00fd           BRCLR 6,_PBWC,L20 ;abs = 0020
  173:    PCTL_BCS = 1;                        /* Select clock source from PLL */
  0023 1800             BSET  4,_PCTL
  174:    __asm("nop");
  0025 9d               NOP   
  175:    __asm("nop");
  0026 9d               NOP   
  176:    /* ### External interrupt "IRQ" init code ... */
  177:    INTSCR_MODE = 1;
  0027 1000             BSET  0,_INTSCR
  178:    INTSCR_IMASK = 1;
  0029 1200             BSET  1,_INTSCR
  179:    INTSCR_ACK = 1;
  002b 1400             BSET  2,_INTSCR
  180:    INTSCR_IMASK = 0;
  002d 1300             BCLR  1,_INTSCR
  181:    /* ### TimerInt "TIMER" init code ... */
  182:    TIMER_Init();
  002f cd0000           JSR   TIMER_Init
  183:    __EI();                              /* Enable interrupts */
  0032 9a               CLI   
  184:  }
  0033 81               RTS   
  185:  
  186:  /* END Cpu. */
  187:  
  188:  /*
  189:  ** ###################################################################
  190:  **
  191:  **     This file was created by UNIS Processor Expert 02.89 for 
  192:  **     the Motorola HC08 series of microcontrollers.
  193:  **
  194:  ** ###################################################################
  195:  */
  196:  
