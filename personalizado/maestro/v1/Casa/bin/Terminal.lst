ANSI-C/cC++ Compiler for HC08 V-5.0.15, Apr 11 2002

    1:  /*
    2:  ** ###################################################################
    3:  **
    4:  **     THIS BEAN MODULE IS GENERATED BY THE TOOL. DO NOT MODIFY IT.
    5:  **
    6:  **     Filename  : Terminal.C
    7:  **
    8:  **     Project   : vph1
    9:  ** 
   10:  **     Processor : MC68HC908GP32CFB
   11:  **
   12:  **     Beantype  : AsynchroSerial
   13:  **
   14:  **     Version   : Bean 02.134, Driver 01.10, CPU db: 2.87.041
   15:  **
   16:  **     Compiler  : Metrowerks HC08 C Compiler V-5.0.13
   17:  **
   18:  **     Date/Time : 8/27/miércoles, 9:31
   19:  **
   20:  **     Abstract  :
   21:  **
   22:  **         This bean "AsynchroSerial" implements an asynchronous serial
   23:  **         communication. The bean supports different settings of 
   24:  **         parity, word width, stop-bit and communication speed,
   25:  **         user can select interrupt or polling handler.
   26:  **         Communication speed can be changed also in runtime.
   27:  **         The bean requires one on-chip asynchronous serial channel.
   28:  **
   29:  **     Settings  :
   30:  **
   31:  **         Serial channel              : SCI
   32:  **
   33:  **         Protocol
   34:  **             Init baud rate          : 9600baud
   35:  **             Width                   : 8 bits
   36:  **             Stop bits               : 1
   37:  **             Parity                  : none
   38:  **             Breaks                  : Disabled
   39:  **
   40:  **         Registers
   41:  **             Input buffer            : SCDR      [24]
   42:  **             Output buffer           : SCDR      [24]
   43:  **             Control register        : SCC1      [19]
   44:  **             Mode register           : SCC2      [20]
   45:  **             Baud setting reg.       : SCBR      [25]
   46:  **             Special register        : SCS1      [22]
   47:  **
   48:  **
   49:  **
   50:  **         Used pins                   : 
   51:  **             ----------------------------------------------------
   52:  **               Function | On package |    Name
   53:  **             ----------------------------------------------------
   54:  **                Output  |     9      |  PTE0_TxD
   55:  **             ----------------------------------------------------
   56:  **
   57:  **
   58:  **
   59:  **     Contents  :
   60:  **
   61:  **         SendChar        - byte Terminal_SendChar(word Chr);
   62:  **         GetCharsInTxBuf - word Terminal_GetCharsInTxBuf(void);
   63:  **
   64:  **
   65:  **     (c) Copyright UNIS, spol. s r.o. 1997-2002
   66:  **
   67:  **     UNIS, spol. s r.o.
   68:  **     Jundrovska 33
   69:  **     624 00 Brno
   70:  **     Czech Republic
   71:  **
   72:  **     http      : www.processorexpert.com
   73:  **     mail      : info@processorexpert.com
   74:  **
   75:  ** ###################################################################
   76:  */
   77:  
   78:  /* MODULE Terminal. */
   79:  #pragma MESSAGE DISABLE C4002 /* WARNING C4002: Result not used is ignored */
   80:  
   81:  #include "Terminal.h"
   82:  #include "Teclado.h"
   83:  #include "IRQ.h"
   84:  #include "TIMER.h"
   85:  
   86:  
   87:  #define OVERRUN_ERR      1             /* Overrun error flag bit   */
   88:  #define FRAMING_ERR      2             /* Framing error flag bit   */
   89:  #define PARITY_ERR       4             /* Parity error flag bit    */
   90:  #define CHAR_IN_RX       8             /* Char is in RX buffer     */
   91:  #define FULL_TX          16            /* Full transmit buffer     */
   92:  #define RUNINT_FROM_TX   32            /* Interrupt is in progress */
   93:  #define FULL_RX          64            /* Full receive buffer      */
   94:  #define NOISE_ERR        128           /* Noise erorr flag bit     */
   95:  #define IDLE_ERR         256           /* Idle character flag bit  */
   96:  #define BREAK_ERR        512           /* Break detect             */
   97:  
   98:  static word SerFlag;                   /* Flags for serial communication */
   99:                                         /* Bits: 0 - OverRun error */
  100:                                         /*       1 - Framing error */
  101:                                         /*       2 - Parity error */
  102:                                         /*       3 - Char in RX buffer */
  103:                                         /*       4 - Full TX buffer */
  104:                                         /*       5 - Unused */
  105:                                         /*       6 - Full RX buffer */
  106:                                         /*       7 - Noise error */
  107:                                         /*       8 - Idle character  */
  108:                                         /*       9 - Break detected  */
  109:                                         /*      10 - Unused */
  110:  
  111:  
  112:  /*
  113:  ** ===================================================================
  114:  **     Method      :  Terminal_HWEnDi (bean AsynchroSerial)
  115:  **
  116:  **     Description :
  117:  **         This method is internal. It is used by Processor Expert
  118:  **         only.
  119:  ** ===================================================================
  120:  */
  121:  void Terminal_HWEnDi(void)
  122:  {

Function: Terminal_HWEnDi
Source  : Z:\vph1\Casa\Code\Terminal.C
Options : -Cc -Env"GENPATH=Z:\vph1\Casa;Z:\vph1\Casa\bin;Z:\vph1\Casa\cmd;*Z:\vph1\Casa\Code;Z:\vph1\Casa\prm;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\LIB;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\src;*D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\Bin\Plugins\support\ProcessorExpert;*Z:\vph1\Comun;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\INCLUDE" -Env"LIBPATH=D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\INCLUDE" -EnvOBJPATH=Z:\vph1\Casa\bin -EnvTEXTPATH=Z:\vph1\Casa\bin -Lasm=%n.lst -ObjN=Z:\vph1\Casa\vph1_Data\P&E_PEDebug_FCS-ICS-ICD\ObjectCode\Terminal.C.o -Qvtpfar -WmsgSd1106 -WmsgSd4002

  123:      SCC1_ENSCI = 1;                    /* Enable device */
  0000 1c00             BSET  6,_SCC1
  124:      SCC2_TE = 1;                       /* Enable transmitter */
  0002 1600             BSET  3,_SCC2
  125:      SCC2_RE = 1;                       /* Enable receiver */
  0004 1400             BSET  2,_SCC2
  126:  }
  0006 81               RTS   
  127:  
  128:  
  129:  /*
  130:  ** ===================================================================
  131:  **     Method      :  Terminal_SendChar (bean AsynchroSerial)
  132:  **
  133:  **     Description :
  134:  **         Send one character to the channel. This method is
  135:  **         available only if the transmitter property is enabled.
  136:  **     Parameters  :
  137:  **         NAME            - DESCRIPTION
  138:  **         Chr             - Character to send
  139:  **     Returns     :
  140:  **         ---             - Error code, possible codes:
  141:  **                           ERR_OK - OK
  142:  **                           ERR_SPEED - This device does not work in
  143:  **                           the active speed mode
  144:  **                           ERR_TXFULL - Transmitter is full
  145:  ** ===================================================================
  146:  */
  147:  byte Terminal_SendChar(byte Chr)
  148:  {

Function: Terminal_SendChar
Source  : Z:\vph1\Casa\Code\Terminal.C
Options : -Cc -Env"GENPATH=Z:\vph1\Casa;Z:\vph1\Casa\bin;Z:\vph1\Casa\cmd;*Z:\vph1\Casa\Code;Z:\vph1\Casa\prm;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\LIB;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\src;*D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\Bin\Plugins\support\ProcessorExpert;*Z:\vph1\Comun;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\INCLUDE" -Env"LIBPATH=D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\INCLUDE" -EnvOBJPATH=Z:\vph1\Casa\bin -EnvTEXTPATH=Z:\vph1\Casa\bin -Lasm=%n.lst -ObjN=Z:\vph1\Casa\vph1_Data\P&E_PEDebug_FCS-ICS-ICD\ObjectCode\Terminal.C.o -Qvtpfar -WmsgSd1106 -WmsgSd4002

  149:    if(!SCS1_SCTE)                       /* Is the transmitter empty? */
  0000 0e0003           BRSET 7,_SCS1,L6 ;abs = 0006
  150:      return ERR_TXFULL;                 /* If no then error */
  0003 a60b             LDA   #11
  0005 81               RTS   
  0006          L6:     
  151:    SCDR = (byte)Chr;
  0006 b700             STA   _SCDR
  152:    return ERR_OK;                       /* OK */
  0008 4f               CLRA  
  153:  }
  0009 81               RTS   
  154:  
  155:  /*
  156:  ** ===================================================================
  157:  **     Method      :  Terminal_GetCharsInTxBuf (bean AsynchroSerial)
  158:  **
  159:  **     Description :
  160:  **         Return number of characters in the output buffer. This
  161:  **         method is available only if the transmitter property is
  162:  **         enabled.
  163:  **     Parameters  : None
  164:  **     Returns     :
  165:  **         ---             - Number of characters in the output
  166:  **                           buffer.
  167:  ** ===================================================================
  168:  */
  169:  word Terminal_GetCharsInTxBuf(void)
  170:  {

Function: Terminal_GetCharsInTxBuf
Source  : Z:\vph1\Casa\Code\Terminal.C
Options : -Cc -Env"GENPATH=Z:\vph1\Casa;Z:\vph1\Casa\bin;Z:\vph1\Casa\cmd;*Z:\vph1\Casa\Code;Z:\vph1\Casa\prm;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\LIB;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\src;*D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\Bin\Plugins\support\ProcessorExpert;*Z:\vph1\Comun;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\INCLUDE" -Env"LIBPATH=D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\INCLUDE" -EnvOBJPATH=Z:\vph1\Casa\bin -EnvTEXTPATH=Z:\vph1\Casa\bin -Lasm=%n.lst -ObjN=Z:\vph1\Casa\vph1_Data\P&E_PEDebug_FCS-ICS-ICD\ObjectCode\Terminal.C.o -Qvtpfar -WmsgSd1106 -WmsgSd4002

  171:    return (!SCS1_SCTE);                 /* Return number of chars in the transmitter buffer */
  0000 0f0003           BRCLR 7,_SCS1,L6 ;abs = 0006
  0003 5f               CLRX  
  0004 4f               CLRA  
  0005 81               RTS   
  0006          L6:     
  0006 a601             LDA   #1
  0008 5f               CLRX  
  172:  }
  0009 81               RTS   
  173:  
  174:  /*
  175:  ** ===================================================================
  176:  **     Method      :  Terminal_Init (bean AsynchroSerial)
  177:  **
  178:  **     Description :
  179:  **         This method is internal. It is used by Processor Expert
  180:  **         only.
  181:  ** ===================================================================
  182:  */
  183:  void Terminal_Init(void)
  184:  {

Function: Terminal_Init
Source  : Z:\vph1\Casa\Code\Terminal.C
Options : -Cc -Env"GENPATH=Z:\vph1\Casa;Z:\vph1\Casa\bin;Z:\vph1\Casa\cmd;*Z:\vph1\Casa\Code;Z:\vph1\Casa\prm;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\LIB;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\src;*D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\Bin\Plugins\support\ProcessorExpert;*Z:\vph1\Comun;D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\INCLUDE" -Env"LIBPATH=D:\Archivos de programa\Metrowerks\CodeWarrior HC08_V2.0\lib\HC08c\INCLUDE" -EnvOBJPATH=Z:\vph1\Casa\bin -EnvTEXTPATH=Z:\vph1\Casa\bin -Lasm=%n.lst -ObjN=Z:\vph1\Casa\vph1_Data\P&E_PEDebug_FCS-ICS-ICD\ObjectCode\Terminal.C.o -Qvtpfar -WmsgSd1106 -WmsgSd4002

  185:    SerFlag = 0;                         /* Reset flags */
  0000 4f               CLRA  
  0001 c70001           STA   SerFlag:1
  0004 c70000           STA   SerFlag
  186:    SCC1 = 0;
  0007 3f00             CLR   _SCC1
  187:    SCC3 = 0;                            /* Disable error interrupts */
  0009 3f00             CLR   _SCC3
  188:    SCBR_SCP = 0;                        /* Set prescaler bits */
  000b b600             LDA   _SCBR
  000d a4cf             AND   #-49
  000f b700             STA   _SCBR
  189:    SCBR_SCR = 2;                        /* Set divisor bits */
  0011 b600             LDA   _SCBR
  0013 a4f8             AND   #-8
  0015 aa02             ORA   #2
  0017 b700             STA   _SCBR
  190:    Terminal_HWEnDi();                   /* Enable/disable device according to status flags */
  0019 2000             BRA   Terminal_HWEnDi
  191:  }
  192:  
  193:  
  194:  /* END Terminal. */
  195:  
  196:  
  197:  /*
  198:  ** ###################################################################
  199:  **
  200:  **     This file was created by UNIS Processor Expert 02.89 for 
  201:  **     the Motorola HC08 series of microcontrollers.
  202:  **
  203:  ** ###################################################################
  204:  */
  205:  
